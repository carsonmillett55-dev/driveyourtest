<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drive Your Test - Driver's Education & Permit Practice</title>
  <meta name="description" content="Master your permit test and driving exam with interactive flashcards and practice tests.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6924346257512616" crossorigin="anonymous"></script>
  
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      --radius: 0.75rem;
      --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }
    body { font-family: var(--font-sans); background: linear-gradient(to bottom right, #f8fafc, #fff, #f1f5f9); min-height: 100vh; color: #1e293b; line-height: 1.5; }
    
    /* Header */
    .header { position: sticky; top: 0; z-index: 50; background: linear-gradient(to right, #1e293b, #334155, #1e293b); color: white; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); border-bottom: 1px solid rgb(51 65 85 / 0.5); }
    .header-content { max-width: 72rem; margin: 0 auto; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; }
    .logo { display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; font-size: 1rem; }
    .logo:hover { opacity: 0.9; }
    .logo-icon { font-size: 1.5rem; }
    .logo-text { font-size: 1.25rem; font-weight: 700; background: linear-gradient(to right, #60a5fa, #c084fc, #60a5fa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    
    /* Layout */
    .main { padding-bottom: 2rem; }
    .container { max-width: 72rem; margin: 0 auto; padding: 0 1rem; }
    .page-layout { display: flex; gap: 1.5rem; max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
    .main-content { flex: 1; min-width: 0; }
    .sidebar { width: 160px; flex-shrink: 0; display: none; }
    @media (min-width: 1024px) { .sidebar { display: block; } }
    
    /* View Container */
    .view-container { display: none; }
    .view-container.active { display: block; }
    
    /* Hero */
    .hero { text-align: center; padding: 2rem 0; }
    .hero-title { font-size: 2.5rem; font-weight: 700; background: linear-gradient(to right, #1e293b, #475569); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.75rem; }
    .hero-subtitle { color: #64748b; font-size: 1.125rem; }
    
    /* Cards */
    .card { background: white; border-radius: var(--radius); border: 1px solid #e2e8f0; box-shadow: var(--shadow-xl); overflow: hidden; }
    .card-header { padding: 1.5rem; }
    .card-title { font-size: 1.125rem; font-weight: 600; color: #1e293b; display: flex; align-items: center; gap: 0.5rem; }
    .card-content { padding: 0 1.5rem 1.5rem; }
    .card-footer { padding: 1.5rem; border-top: 1px solid #f1f5f9; }
    
    /* Progress */
    .progress-card { background: linear-gradient(to bottom right, #f8fafc, #f1f5f9); }
    .progress-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    @media (min-width: 768px) { .progress-grid { grid-template-columns: repeat(5, 1fr); } }
    .progress-item { text-align: center; }
    .progress-value { font-size: 1.875rem; font-weight: 700; }
    .progress-label { font-size: 0.875rem; color: #64748b; }
    .gradient-emerald { background: linear-gradient(to right, #059669, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .gradient-blue { background: linear-gradient(to right, #2563eb, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .gradient-purple { background: linear-gradient(to right, #9333ea, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .progress-bar { width: 100%; height: 8px; background: #e2e8f0; border-radius: 9999px; overflow: hidden; margin-bottom: 1rem; }
    .progress-fill { height: 100%; border-radius: 9999px; transition: width 0.3s; }
    .progress-fill-emerald { background: linear-gradient(to right, #059669, #0d9488); }
    
    /* Mode Cards */
    .modes-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media (min-width: 768px) { .modes-grid { grid-template-columns: repeat(3, 1fr); } }
    .mode-card { cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
    .mode-card:hover { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); transform: translateY(-2px); }
    .mode-card-emerald:hover { border-color: rgb(52 211 153 / 0.5); }
    .mode-card-blue:hover { border-color: rgb(96 165 250 / 0.5); }
    .mode-card-purple:hover { border-color: rgb(192 132 252 / 0.5); }
    .mode-card-bar { height: 4px; }
    .bar-emerald { background: linear-gradient(to right, #34d399, #2dd4bf); }
    .bar-blue { background: linear-gradient(to right, #60a5fa, #22d3ee); }
    .bar-purple { background: linear-gradient(to right, #c084fc, #f472b6); }
    .mode-card-bg-emerald { background: linear-gradient(to bottom right, white, rgb(236 253 245 / 0.3)); }
    .mode-card-bg-blue { background: linear-gradient(to bottom right, white, rgb(239 246 255 / 0.3)); }
    .mode-card-bg-purple { background: linear-gradient(to bottom right, white, rgb(250 245 255 / 0.3)); }
    .mode-icon { font-size: 3rem; margin-bottom: 0.75rem; }
    .mode-header { display: flex; justify-content: space-between; align-items: flex-start; }
    .mode-title { font-weight: 600; font-size: 1.25rem; }
    .title-emerald { background: linear-gradient(to right, #047857, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .title-blue { background: linear-gradient(to right, #1d4ed8, #0891b2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .title-purple { background: linear-gradient(to right, #7c3aed, #be185d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .mode-desc { font-size: 0.875rem; color: #64748b; }
    
    /* Badges */
    .badge { display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; padding: 0.125rem 0.5rem; font-size: 0.75rem; font-weight: 500; }
    .badge-emerald { background: linear-gradient(to right, #059669, #0d9488); color: white; box-shadow: var(--shadow-lg); }
    .badge-blue { background: linear-gradient(to right, #2563eb, #06b6d4); color: white; box-shadow: var(--shadow-lg); }
    .badge-purple { background: linear-gradient(to right, #9333ea, #ec4899); color: white; box-shadow: var(--shadow-lg); }
    .badge-outline-blue { border: 1px solid #93c5fd; color: #1d4ed8; }
    .badge-outline-purple { border: 1px solid #d8b4fe; color: #7c3aed; }
    
    /* Tags */
    .tags { display: flex; flex-wrap: wrap; gap: 0.25rem; font-size: 0.75rem; color: #64748b; }
    .tag { padding: 0.25rem 0.5rem; background: rgb(236 253 245); border-radius: 0.25rem; }
    
    /* Buttons */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: 0.375rem; border: none; cursor: pointer; transition: all 0.2s; width: 100%; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-emerald { background: linear-gradient(to right, #059669, #0d9488); color: white; box-shadow: var(--shadow-lg); }
    .btn-emerald:hover:not(:disabled) { background: linear-gradient(to right, #047857, #0f766e); }
    .btn-blue { background: linear-gradient(to right, #2563eb, #06b6d4); color: white; box-shadow: var(--shadow-lg); }
    .btn-blue:hover:not(:disabled) { background: linear-gradient(to right, #1d4ed8, #0891b2); }
    .btn-purple { background: linear-gradient(to right, #9333ea, #ec4899); color: white; box-shadow: var(--shadow-lg); }
    .btn-purple:hover:not(:disabled) { background: linear-gradient(to right, #7c3aed, #be185d); }
    .btn-outline { background: white; border: 1px solid #e2e8f0; color: #475569; }
    .btn-outline:hover:not(:disabled) { background: #f8fafc; }
    .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.75rem; width: auto; }
    
    /* Back Header */
    .back-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
    .back-btn { padding: 0.5rem 1rem; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; color: #64748b; transition: all 0.2s; }
    .back-btn:hover { background: #f8fafc; color: #1e293b; }
    .view-title { font-size: 1.5rem; font-weight: 700; }
    
    /* Flashcards */
    .category-selector { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem; }
    .category-btn { padding: 0.5rem 1rem; background: white; border: 1px solid #e2e8f0; border-radius: 9999px; cursor: pointer; font-size: 0.75rem; color: #64748b; transition: all 0.2s; }
    .category-btn:hover, .category-btn.active { background: #059669; color: white; border-color: #059669; }
    .flashcard-container { perspective: 1000px; margin-bottom: 1.5rem; }
    .flashcard { width: 100%; height: 280px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--radius); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; box-shadow: var(--shadow-xl); }
    .flashcard-front { background: linear-gradient(135deg, #ecfdf5, #d1fae5); border: 2px solid #6ee7b7; }
    .flashcard-back { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid #86efac; transform: rotateY(180deg); }
    .flashcard-category { font-size: 0.75rem; color: #059669; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .flashcard-text { font-size: 1.125rem; color: #1e293b; line-height: 1.6; }
    .flashcard-hint { font-size: 0.75rem; color: #64748b; margin-top: 1rem; }
    .card-nav { display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1rem; }
    .nav-btn { width: 48px; height: 48px; border-radius: 50%; background: white; border: 1px solid #e2e8f0; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .nav-btn:hover { background: #f1f5f9; }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .card-counter { font-size: 0.875rem; color: #64748b; min-width: 60px; text-align: center; }
    .rating-buttons { display: flex; gap: 1rem; justify-content: center; }
    .rating-btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; }
    .rating-know { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
    .rating-know:hover { background: #bbf7d0; }
    .rating-practice { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
    .rating-practice:hover { background: #fde68a; }
    
    /* Test Styles */
    .test-progress { margin-bottom: 1.5rem; }
    .test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .test-timer { font-size: 1.25rem; font-weight: 700; color: #2563eb; }
    .question-counter { font-size: 0.875rem; color: #64748b; }
    .question-card { background: white; border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1rem; box-shadow: var(--shadow-lg); }
    .question-category { font-size: 0.75rem; color: #2563eb; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem; display: inline-block; background: #eff6ff; padding: 0.25rem 0.5rem; border-radius: 0.25rem; }
    .question-text { font-size: 1.125rem; font-weight: 600; color: #1e293b; margin-bottom: 1.5rem; line-height: 1.6; }
    .options-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .option-item { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s; }
    .option-item:hover { border-color: #93c5fd; background: #eff6ff; }
    .option-item.selected { border-color: #3b82f6; background: #eff6ff; }
    .option-item.correct { border-color: #22c55e; background: #f0fdf4; }
    .option-item.incorrect { border-color: #ef4444; background: #fef2f2; }
    .option-item.disabled { cursor: default; }
    .option-radio { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #cbd5e1; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
    .option-item.selected .option-radio { border-color: #3b82f6; background: #3b82f6; }
    .option-item.selected .option-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }
    .option-text { font-size: 0.9375rem; color: #334155; }
    .test-actions { display: flex; gap: 1rem; }
    .hidden { display: none !important; }
    
    /* Explanation */
    .explanation { margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 0.5rem; border-left: 4px solid #22c55e; }
    .explanation-title { font-weight: 600; color: #166534; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .explanation-text { color: #15803d; font-size: 0.875rem; line-height: 1.6; }
    
    /* Results */
    .results-card { text-align: center; padding: 2rem; }
    .results-icon { font-size: 4rem; margin-bottom: 1rem; }
    .results-title { font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem; }
    .results-score { font-size: 3rem; font-weight: 700; margin-bottom: 1.5rem; }
    .results-stats { display: flex; justify-content: center; gap: 2rem; margin-bottom: 1.5rem; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: #1e293b; }
    .stat-label { font-size: 0.75rem; color: #64748b; }
    .results-actions { display: flex; gap: 1rem; justify-content: center; }
    
    /* Scenario Card */
    .scenario-card { background: linear-gradient(135deg, #faf5ff, #f3e8ff); border: 2px solid #d8b4fe; border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1rem; position: relative; }
    .scenario-topic { font-size: 0.75rem; color: #7c3aed; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .scenario-text { font-size: 1rem; color: #1e293b; line-height: 1.6; margin-top: 0.75rem; }
    .difficulty-badge { position: absolute; top: 1rem; right: 1rem; font-size: 0.625rem; padding: 0.25rem 0.5rem; border-radius: 9999px; font-weight: 600; text-transform: uppercase; }
    .difficulty-easy { background: #dcfce7; color: #166534; }
    .difficulty-medium { background: #fef3c7; color: #92400e; }
    .difficulty-hard { background: #fee2e2; color: #991b1b; }
    
    /* Resume Banner */
    .resume-banner { background: linear-gradient(to right, #eff6ff, #f0f9ff); border: 1px solid #93c5fd; border-radius: 0.5rem; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
    .resume-text { font-size: 0.875rem; color: #1d4ed8; }
    .resume-actions { display: flex; gap: 0.5rem; }
    
    /* Analytics */
    .analytics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    @media (min-width: 640px) { .analytics-grid { grid-template-columns: repeat(4, 1fr); } }
    .stat-card { padding: 1.5rem; text-align: center; }
    .stat-card-title { font-size: 0.75rem; color: #64748b; margin-bottom: 0.5rem; }
    .stat-card-value { font-size: 2rem; font-weight: 700; color: #1e293b; }
    
    /* Footer */
    .site-footer { background: linear-gradient(to right, #1e293b, #334155, #1e293b); color: #94a3b8; padding: 2rem 1rem; margin-top: 2rem; border-top: 1px solid rgb(51 65 85 / 0.5); }
    .footer-content { max-width: 72rem; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 1rem; text-align: center; }
    .footer-brand { display: flex; align-items: center; gap: 0.5rem; }
    .footer-logo { font-size: 1.5rem; }
    .footer-name { font-size: 1.125rem; font-weight: 600; color: white; }
    .footer-nav { display: flex; gap: 2rem; flex-wrap: wrap; justify-content: center; }
    .footer-nav a { color: #94a3b8; text-decoration: none; font-size: 0.875rem; transition: color 0.2s; cursor: pointer; }
    .footer-nav a:hover { color: white; }
    .footer-copy { font-size: 0.75rem; color: #64748b; }
    @media (min-width: 768px) { .footer-content { flex-direction: row; justify-content: space-between; } }
    
    /* Privacy & Contact Pages */
    .page-content { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
    .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
    .page-subtitle { color: #64748b; margin-bottom: 2rem; }
    .section-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e2e8f0; }
    .content-section { margin-bottom: 2rem; }
    .content-section p, .content-section li { color: #475569; margin-bottom: 0.75rem; line-height: 1.7; }
    .content-section ul { padding-left: 1.5rem; }
    .highlight-box { background: #f0f9ff; border-left: 4px solid #3b82f6; padding: 1rem; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }
    .highlight-box p { color: #1e40af; margin: 0; }
    
    /* Form Styles */
    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; font-weight: 500; color: #334155; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .form-input, .form-textarea, .form-select { width: 100%; padding: 0.75rem 1rem; font-size: 1rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; background: white; transition: all 0.2s; font-family: inherit; }
    .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: #3b82f6; }
    .form-textarea { min-height: 150px; resize: vertical; }
    .form-hint { font-size: 0.75rem; color: #64748b; margin-top: 0.25rem; }
    .submit-btn { width: 100%; padding: 1rem; font-size: 1rem; font-weight: 600; color: white; background: linear-gradient(to right, #2563eb, #06b6d4); border: none; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s; }
    .submit-btn:hover { background: linear-gradient(to right, #1d4ed8, #0891b2); }
    
    /* Info Cards */
    .info-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem; }
    .info-card { background: #f8fafc; border-radius: 0.75rem; padding: 1.5rem; text-align: center; border: 1px solid #e2e8f0; }
    .info-icon { font-size: 2rem; margin-bottom: 0.5rem; }
    .info-title { font-weight: 600; color: #1e293b; margin-bottom: 0.25rem; }
    .info-text { font-size: 0.875rem; color: #64748b; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <button class="logo" onclick="goHome()">
        <span class="logo-icon">üöó</span>
        <span class="logo-text">driveyourtest.com</span>
      </button>
    </div>
  </header>

  <main class="main">
    <!-- ==================== HOME VIEW ==================== -->
    <div id="home-view" class="view-container active">
      <!-- Ad: Top of Content -->
      <div class="container" style="padding-top: 1rem;">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_1" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>

      <div class="page-layout">
        <div class="main-content">
          <div class="hero">
            <h1 class="hero-title">Drive Your Test Results</h1>
            <p class="hero-subtitle">Master your permit test and driving exam with interactive study tools.</p>
          </div>

          <div id="resume-banner" class="resume-banner hidden">
            <span class="resume-text">üìã You have a session in progress</span>
            <div class="resume-actions">
              <button class="btn btn-sm btn-outline" onclick="clearSessionAndRefresh()">Start Fresh</button>
            </div>
          </div>

          <div class="card progress-card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
              <div class="card-title"><span>üìä</span> Your Progress</div>
            </div>
            <div class="card-content">
              <div class="progress-grid">
                <div class="progress-item">
                  <div class="progress-value gradient-emerald" id="flashcard-progress">0%</div>
                  <div class="progress-label">Flashcards</div>
                </div>
                <div class="progress-item">
                  <div class="progress-value gradient-blue" id="permit-tests">0</div>
                  <div class="progress-label">Permit Tests</div>
                </div>
                <div class="progress-item">
                  <div class="progress-value gradient-blue" id="best-score">-</div>
                  <div class="progress-label">Best Score</div>
                </div>
                <div class="progress-item">
                  <div class="progress-value gradient-purple" id="scenario-tests">0</div>
                  <div class="progress-label">Scenario Tests</div>
                </div>
                <div class="progress-item">
                  <div class="progress-value gradient-purple" id="scenario-best">-</div>
                  <div class="progress-label">Scenario Best</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ad: Mid Content -->
          <ins class="adsbygoogle" style="display:block; margin: 1.5rem 0;" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_2" data-ad-format="auto" data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

          <div class="modes-grid">
            <!-- Flashcards -->
            <div class="card mode-card mode-card-emerald mode-card-bg-emerald" onclick="startFlashcards()">
              <div class="mode-card-bar bar-emerald"></div>
              <div class="card-header">
                <div class="mode-header">
                  <div class="mode-icon">üìö</div>
                  <span class="badge badge-emerald" id="flashcard-badge">0%</span>
                </div>
                <div class="mode-title title-emerald">Permit Flash Cards</div>
                <div class="mode-desc">100 flashcards covering all test topics.</div>
              </div>
              <div class="card-content">
                <div class="progress-bar">
                  <div class="progress-fill progress-fill-emerald" id="flashcard-bar" style="width: 0%"></div>
                </div>
                <div class="tags">
                  <span class="tag">Road Signs</span>
                  <span class="tag">Traffic Laws</span>
                  <span class="tag">Right-of-Way</span>
                  <span class="tag">Safe Driving</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn btn-emerald">Start Learning</button>
              </div>
            </div>

            <!-- Permit Test -->
            <div class="card mode-card mode-card-blue mode-card-bg-blue" onclick="startPermitTest()">
              <div class="mode-card-bar bar-blue"></div>
              <div class="card-header">
                <div class="mode-header">
                  <div class="mode-icon">üìù</div>
                  <span class="badge badge-blue">Ready</span>
                </div>
                <div class="mode-title title-blue">Permit Practice Test</div>
                <div class="mode-desc">40 questions ‚Ä¢ 45 minutes ‚Ä¢ Timed</div>
              </div>
              <div class="card-content">
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                  <span class="badge badge-outline-blue">Timed</span>
                  <span class="badge badge-outline-blue">Instant Feedback</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn btn-blue">Take Test</button>
              </div>
            </div>

            <!-- Driving Scenarios -->
            <div class="card mode-card mode-card-purple mode-card-bg-purple" onclick="startScenarios()">
              <div class="mode-card-bar bar-purple"></div>
              <div class="card-header">
                <div class="mode-header">
                  <div class="mode-icon">üöô</div>
                  <span class="badge badge-purple">Ready</span>
                </div>
                <div class="mode-title title-purple">Driving Scenarios</div>
                <div class="mode-desc">20 scenarios ‚Ä¢ No time limit</div>
              </div>
              <div class="card-content">
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                  <span class="badge badge-outline-purple">No Timer</span>
                  <span class="badge badge-outline-purple">Explanations</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn btn-purple">Start Test</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ad: Sidebar (Desktop Only) -->
        <aside class="sidebar">
          <ins class="adsbygoogle" style="display:block; width: 160px; height: 600px;" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_3" data-ad-format="vertical"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </aside>
      </div>
    </div>

    <!-- ==================== FLASHCARDS VIEW ==================== -->
    <div id="flashcards-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back</button>
          <h2 class="view-title">Permit Flash Cards</h2>
        </div>

        <div class="category-selector">
          <button class="category-btn active" data-category="all" onclick="selectCategory('all')">All (100)</button>
          <button class="category-btn" data-category="Road Signs" onclick="selectCategory('Road Signs')">Road Signs (25)</button>
          <button class="category-btn" data-category="Traffic Laws" onclick="selectCategory('Traffic Laws')">Traffic Laws (30)</button>
          <button class="category-btn" data-category="Right-of-Way" onclick="selectCategory('Right-of-Way')">Right-of-Way (20)</button>
          <button class="category-btn" data-category="Safe Driving" onclick="selectCategory('Safe Driving')">Safe Driving (25)</button>
        </div>

        <div class="flashcard-container">
          <div class="flashcard" id="flashcard" onclick="flipCard()">
            <div class="flashcard-face flashcard-front">
              <div class="flashcard-category" id="card-category">Category</div>
              <div class="flashcard-text" id="card-front">Question</div>
              <div class="flashcard-hint">Click to flip</div>
            </div>
            <div class="flashcard-face flashcard-back">
              <div class="flashcard-text" id="card-back">Answer</div>
              <div class="flashcard-hint">Click to flip back</div>
            </div>
          </div>
        </div>

        <div class="card-nav">
          <button class="nav-btn" id="prev-btn" onclick="prevCard()">‚Üê</button>
          <span class="card-counter"><span id="card-index">1</span> / <span id="card-total">100</span></span>
          <button class="nav-btn" id="next-btn" onclick="nextCard()">‚Üí</button>
        </div>

        <div class="rating-buttons" id="rating-buttons">
          <button class="rating-btn rating-know" onclick="rateCard('known')">‚úì I Know This</button>
          <button class="rating-btn rating-practice" onclick="rateCard('practice')">‚Üí Needs Practice</button>
        </div>
      </div>
    </div>

    <!-- ==================== PERMIT TEST VIEW ==================== -->
    <div id="permit-test-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="confirmExit()">‚Üê Exit Test</button>
          <h2 class="view-title">Permit Practice Test</h2>
        </div>

        <div class="page-layout">
          <div class="main-content">
            <div class="test-progress">
              <div class="test-header">
                <span class="test-timer" id="test-timer">45:00</span>
                <span class="question-counter">Question <span id="test-index">1</span> of <span id="test-total">40</span></span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="test-progress-bar" style="width: 0%; background: linear-gradient(to right, #2563eb, #06b6d4);"></div>
              </div>
            </div>

            <div class="question-card" id="test-question-card">
              <span class="question-category" id="test-category">Category</span>
              <div class="question-text" id="test-question">Question text</div>
              <div class="options-list" id="test-options"></div>
            </div>

            <div class="test-actions" id="test-actions">
              <button class="btn btn-outline" id="submit-btn" onclick="submitTestAnswer()" disabled>Submit Answer</button>
              <button class="btn btn-blue hidden" id="next-question-btn" onclick="nextTestQuestion()">Next Question ‚Üí</button>
            </div>

            <div class="results-card card hidden" id="test-results">
              <div class="results-icon" id="results-icon">üéâ</div>
              <div class="results-title" id="results-title">Test Complete!</div>
              <div class="results-score" id="results-score">85%</div>
              <div class="results-stats">
                <div class="stat-item">
                  <div class="stat-value" id="correct-count">34</div>
                  <div class="stat-label">Correct</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="incorrect-count">6</div>
                  <div class="stat-label">Incorrect</div>
                </div>
              </div>
              <div class="results-actions">
                <button class="btn btn-outline" onclick="goHome()">Back to Home</button>
                <button class="btn btn-blue" onclick="startPermitTest()">Retake Test</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== SCENARIOS VIEW ==================== -->
    <div id="scenarios-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="confirmExit()">‚Üê Exit Test</button>
          <h2 class="view-title">Driving Scenarios</h2>
        </div>

        <div class="page-layout">
          <div class="main-content">
            <div class="test-progress">
              <div class="test-header">
                <span class="test-timer" style="color: #7c3aed;">No Time Limit</span>
                <span class="question-counter">Scenario <span id="scenario-index">1</span> of <span id="scenario-total">20</span></span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="scenario-progress-bar" style="width: 0%; background: linear-gradient(to right, #9333ea, #ec4899);"></div>
              </div>
            </div>

            <div class="scenario-card" id="scenario-card">
              <span class="scenario-topic" id="scenario-topic">Topic</span>
              <span class="difficulty-badge difficulty-medium" id="scenario-difficulty">Medium</span>
              <div class="scenario-text" id="scenario-text">Scenario description</div>
            </div>

            <div class="question-card" id="scenario-question-card">
              <div class="question-text" id="scenario-question">Question text</div>
              <div class="options-list" id="scenario-options"></div>
            </div>

            <div class="test-actions" id="scenario-actions">
              <button class="btn btn-outline" id="scenario-submit-btn" onclick="submitScenarioAnswer()" disabled>Submit Answer</button>
              <button class="btn btn-purple hidden" id="next-scenario-btn" onclick="nextScenario()">Next Scenario ‚Üí</button>
            </div>

            <div class="results-card card hidden" id="scenario-results">
              <div class="results-icon" id="scenario-results-icon">üéâ</div>
              <div class="results-title" id="scenario-results-title">Scenarios Complete!</div>
              <div class="results-score" id="scenario-results-score">85%</div>
              <div class="results-stats">
                <div class="stat-item">
                  <div class="stat-value" id="scenario-correct-count">17</div>
                  <div class="stat-label">Correct</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="scenario-incorrect-count">3</div>
                  <div class="stat-label">Incorrect</div>
                </div>
              </div>
              <div class="results-actions">
                <button class="btn btn-outline" onclick="goHome()">Back to Home</button>
                <button class="btn btn-purple" onclick="startScenarios()">Retake Test</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== PRIVACY VIEW ==================== -->
    <div id="privacy-view" class="view-container">
      <div class="page-content">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
        </div>

        <div class="card" style="padding: 2rem;">
          <h1 class="page-title">Privacy Policy</h1>
          <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 2rem;">Last updated: February 21, 2025</p>

          <div class="content-section">
            <h2 class="section-title">Introduction</h2>
            <p>Welcome to Drive Your Test ("we," "our," or "us"). We are committed to protecting your personal information and your right to privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website driveyourtest.com.</p>
          </div>

          <div class="content-section">
            <h2 class="section-title">Information We Collect</h2>
            <p>We collect information that you provide directly to us, information we obtain automatically when you visit our site.</p>
            <ul>
              <li><strong>Contact Information:</strong> When you use our contact form, we collect your name, email address, and message content.</li>
              <li><strong>Learning Progress:</strong> We store your quiz scores, flashcard progress, and test results locally on your device.</li>
              <li><strong>Device Information:</strong> Browser type, operating system, device type</li>
              <li><strong>Usage Data:</strong> Pages visited, time spent on pages, features used</li>
            </ul>
          </div>

          <div class="content-section">
            <h2 class="section-title">Cookies and Tracking Technologies</h2>
            <p>We use cookies and similar tracking technologies to collect and track information and to improve our website.</p>
            <ul>
              <li><strong>Essential Cookies:</strong> Required for the website to function properly (e.g., saving your quiz progress)</li>
              <li><strong>Analytics Cookies:</strong> Help us understand how visitors interact with our website</li>
              <li><strong>Advertising Cookies:</strong> Used to deliver relevant advertisements</li>
            </ul>
          </div>

          <div class="content-section">
            <h2 class="section-title">Third-Party Advertising (Google AdSense)</h2>
            <div class="highlight-box">
              <p><strong>Important:</strong> We use Google AdSense to display advertisements on our website. Google AdSense uses cookies to serve ads based on your prior visits to our website or other websites.</p>
            </div>
            <p>You can opt out of personalized advertising by visiting <a href="https://www.google.com/settings/ads" target="_blank" style="color: #2563eb;">Google Ads Settings</a>.</p>
          </div>

          <div class="content-section">
            <h2 class="section-title">Data Storage and Security</h2>
            <p>Your learning progress is stored locally on your device using your browser's localStorage feature. This data never leaves your device unless you explicitly contact us through our contact form.</p>
          </div>

          <div class="content-section">
            <h2 class="section-title">Children's Privacy</h2>
            <p>Our website is intended for users of all ages who are learning to drive. We do not knowingly collect personal information from children under 13 years of age without parental consent.</p>
          </div>

          <div class="content-section">
            <h2 class="section-title">Contact Us</h2>
            <p>If you have questions or concerns about this Privacy Policy, please contact us at <a href="mailto:driveyourtest@gmail.com" style="color: #2563eb;">driveyourtest@gmail.com</a></p>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== CONTACT VIEW ==================== -->
    <div id="contact-view" class="view-container">
      <div class="page-content">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
        </div>

        <h1 class="page-title" style="text-align: center;">Contact Us</h1>
        <p class="page-subtitle" style="text-align: center;">Have a question, suggestion, or feedback? We'd love to hear from you!</p>

        <div class="card" style="padding: 2rem;">
          <form action="https://formsubmit.co/driveyourtest@gmail.com" method="POST">
            <input type="hidden" name="_subject" value="New Contact Form - Drive Your Test">
            <input type="hidden" name="_captcha" value="true">
            <input type="hidden" name="_template" value="table">

            <div class="form-group">
              <label class="form-label">Full Name <span style="color: #dc2626;">*</span></label>
              <input type="text" name="name" class="form-input" placeholder="John Doe" required>
            </div>

            <div class="form-group">
              <label class="form-label">Email Address <span style="color: #dc2626;">*</span></label>
              <input type="email" name="email" class="form-input" placeholder="john@example.com" required>
              <p class="form-hint">We'll never share your email with anyone else.</p>
            </div>

            <div class="form-group">
              <label class="form-label">Subject <span style="color: #dc2626;">*</span></label>
              <select name="subject" class="form-select" required>
                <option value="">Select a topic...</option>
                <option value="General Question">General Question</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Content Suggestion">Content Suggestion</option>
                <option value="Bug Report">Bug Report</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Message <span style="color: #dc2626;">*</span></label>
              <textarea name="message" class="form-textarea" placeholder="How can we help you?" required></textarea>
              <p class="form-hint">Please provide as much detail as possible.</p>
            </div>

            <button type="submit" class="submit-btn">Send Message</button>

            <div class="highlight-box" style="margin-top: 1.5rem;">
              By submitting this form, you agree to our <a href="#" onclick="showView('privacy'); return false;" style="color: #1d4ed8;">Privacy Policy</a>.
            </div>
          </form>
        </div>

        <div class="info-cards">
          <div class="info-card">
            <div class="info-icon">üìß</div>
            <div class="info-title">Email Us</div>
            <p class="info-text">driveyourtest@gmail.com</p>
          </div>
          <div class="info-card">
            <div class="info-icon">‚è∞</div>
            <div class="info-title">Response Time</div>
            <p class="info-text">Within 24-48 hours</p>
          </div>
          <div class="info-card">
            <div class="info-icon">üîí</div>
            <div class="info-title">Your Privacy</div>
            <p class="info-text">Your data is secure</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== ANALYTICS VIEW ==================== -->
    <div id="analytics-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back</button>
          <h2 class="view-title">Your Analytics</h2>
        </div>

        <div class="analytics-grid">
          <div class="card stat-card">
            <div class="stat-card-title">Total Flashcards Seen</div>
            <div class="stat-card-value" id="stat-flashcards-seen">0</div>
          </div>
          <div class="card stat-card">
            <div class="stat-card-title">Flashcards Known</div>
            <div class="stat-card-value" id="stat-flashcards-known">0</div>
          </div>
          <div class="card stat-card">
            <div class="stat-card-title">Average Test Score</div>
            <div class="stat-card-value" id="stat-avg-score">-</div>
          </div>
          <div class="card stat-card">
            <div class="stat-card-title">Tests Passed</div>
            <div class="stat-card-value" id="stat-tests-passed">0</div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
          <button class="btn btn-outline" style="color: #dc2626; border-color: #fca5a5;" onclick="resetAllProgress()">Reset All Progress</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Site Footer -->
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <span class="footer-logo">üöó</span>
        <span class="footer-name">Drive Your Test</span>
      </div>
      <nav class="footer-nav">
        <a onclick="goHome()">Home</a>
        <a onclick="showView('privacy')">Privacy Policy</a>
        <a onclick="showView('contact')">Contact Us</a>
      </nav>
      <p class="footer-copy">¬© 2025 Drive Your Test. All rights reserved.</p>
    </div>
  </footer>

  <script>
// ==================== FLASHCARD DATA ====================
const permitFlashcards = [
  { id: 'pf1', category: 'Road Signs', front: 'üõë What does a red octagonal sign mean?', back: 'STOP - You must come to a complete stop behind the stop line or crosswalk, then proceed when safe.', difficulty: 'easy' },
  { id: 'pf2', category: 'Road Signs', front: '‚ö†Ô∏è What does a yellow diamond-shaped sign indicate?', back: 'Warning sign - alerts drivers to potential hazards, curves, intersections, or road conditions ahead.', difficulty: 'easy' },
  { id: 'pf3', category: 'Road Signs', front: 'üö∏ What does a pentagon-shaped sign indicate?', back: 'School zone or school crossing - watch for children and reduce speed during school hours.', difficulty: 'easy' },
  { id: 'pf4', category: 'Road Signs', front: 'What does a circular sign mean?', back: 'Railroad crossing ahead - be prepared to stop if a train is approaching.', difficulty: 'medium' },
  { id: 'pf5', category: 'Road Signs', front: 'üÖøÔ∏è What does a blue rectangular sign with a white "P" mean?', back: 'Parking is permitted in this area - check for time restrictions or payment requirements.', difficulty: 'easy' },
  { id: 'pf6', category: 'Road Signs', front: '‚õî What does a red circle with a white horizontal bar mean?', back: 'DO NOT ENTER - this road is closed to traffic in your direction.', difficulty: 'easy' },
  { id: 'pf7', category: 'Road Signs', front: 'What does a "No Passing Zone" pennant sign look like?', back: 'A yellow triangle pointing right, placed on the left side of the road at the beginning of no-passing zones.', difficulty: 'medium' },
  { id: 'pf8', category: 'Road Signs', front: 'What does an orange diamond-shaped sign indicate?', back: 'Construction or maintenance zone ahead - slow down and watch for workers.', difficulty: 'easy' },
  { id: 'pf9', category: 'Road Signs', front: 'What does a red X above a lane mean?', back: 'Lane is closed - do not drive in this lane. Move to an open lane.', difficulty: 'medium' },
  { id: 'pf10', category: 'Road Signs', front: 'What does a green arrow above a lane mean?', back: 'Lane is open for travel - you may proceed in this lane.', difficulty: 'easy' },
  { id: 'pf11', category: 'Road Signs', front: 'What does a yellow X above a lane mean?', back: 'Lane is closing ahead - merge safely into an open lane.', difficulty: 'medium' },
  { id: 'pf12', category: 'Road Signs', front: 'What does a flashing yellow arrow mean?', back: 'Yield to oncoming traffic and pedestrians before turning in the direction of the arrow.', difficulty: 'hard' },
  { id: 'pf13', category: 'Road Signs', front: 'What does a steady red X above a highway lane mean?', back: 'The lane is closed. You must exit the lane immediately and safely.', difficulty: 'medium' },
  { id: 'pf14', category: 'Road Signs', front: 'What does a white rectangular sign typically indicate?', back: 'Regulatory information - traffic laws and rules you must follow, such as speed limits.', difficulty: 'easy' },
  { id: 'pf15', category: 'Road Signs', front: 'What does a yellow rectangular sign typically indicate?', back: 'Warning or guidance - alerts about upcoming conditions, detours, or directions.', difficulty: 'medium' },
  { id: 'pf16', category: 'Road Signs', front: 'What does a red circle with a slash through a symbol mean?', back: 'The action shown by the symbol is prohibited - do NOT do what the symbol shows.', difficulty: 'easy' },
  { id: 'pf17', category: 'Road Signs', front: 'What does a green sign with white text indicate?', back: 'Guide sign - provides directions, distances, and information about destinations.', difficulty: 'easy' },
  { id: 'pf18', category: 'Road Signs', front: 'What does a brown sign with white text indicate?', back: 'Recreational or cultural interest - points to parks, historical sites, and attractions.', difficulty: 'easy' },
  { id: 'pf19', category: 'Road Signs', front: 'What does a blue sign with white text/symbols indicate?', back: 'Service information - gas, food, lodging, hospitals, and other services.', difficulty: 'easy' },
  { id: 'pf20', category: 'Road Signs', front: 'What does a sign showing two arrows pointing in opposite directions mean?', back: 'Two-way traffic ahead - the road changes from one-way to two-way.', difficulty: 'medium' },
  { id: 'pf21', category: 'Road Signs', front: 'What does a sign with a truck going downhill mean?', back: 'Steep grade ahead - truck drivers should use lower gear; all drivers should be cautious.', difficulty: 'medium' },
  { id: 'pf22', category: 'Road Signs', front: 'What does a sign with a winding road symbol mean?', back: 'Winding road ahead - there are three or more curves in succession.', difficulty: 'easy' },
  { id: 'pf23', category: 'Road Signs', front: 'What does a sign showing a car with wavy lines behind it mean?', back: 'Slippery when wet - road surface is slippery when wet, reduce speed.', difficulty: 'easy' },
  { id: 'pf24', category: 'Road Signs', front: 'What does a sign with a person digging mean?', back: 'Construction/work zone ahead - watch for workers and equipment.', difficulty: 'easy' },
  { id: 'pf25', category: 'Road Signs', front: 'What does a sign showing a deer mean?', back: 'Deer crossing area - watch for deer, especially at dawn and dusk.', difficulty: 'easy' },
  { id: 'pf26', category: 'Traffic Laws', front: 'What is the legal blood alcohol concentration (BAC) limit for drivers 21 and over?', back: '0.08% in most states. For commercial drivers, it\'s 0.04%. For drivers under 21, any detectable amount is illegal.', difficulty: 'easy' },
  { id: 'pf27', category: 'Traffic Laws', front: 'How far should you stop from a railroad crossing?', back: 'At least 15 feet but no more than 50 feet from the nearest rail.', difficulty: 'medium' },
  { id: 'pf28', category: 'Traffic Laws', front: 'What is the speed limit in a school zone?', back: 'Usually 15-25 mph when children are present or during school hours. Always check posted signs.', difficulty: 'easy' },
  { id: 'pf29', category: 'Traffic Laws', front: 'When must you use your turn signal?', back: 'At least 100 feet before turning or changing lanes in most states (200 feet in some states).', difficulty: 'easy' },
  { id: 'pf30', category: 'Traffic Laws', front: 'What is the "Move Over" law?', back: 'You must move over one lane or slow down significantly when passing emergency vehicles with flashing lights.', difficulty: 'medium' },
  { id: 'pf31', category: 'Traffic Laws', front: 'What is the speed limit in a business or residential district unless posted?', back: 'Usually 25 mph, but always check for posted speed limit signs.', difficulty: 'easy' },
  { id: 'pf32', category: 'Traffic Laws', front: 'What is the speed limit in an alley unless posted?', back: 'Usually 15 mph unless otherwise posted.', difficulty: 'medium' },
  { id: 'pf33', category: 'Traffic Laws', front: 'How far must you stop from a school bus with flashing red lights?', back: 'At least 20 feet from the bus on undivided roads, in both directions.', difficulty: 'easy' },
  { id: 'pf34', category: 'Traffic Laws', front: 'When are you required to wear a seatbelt?', back: 'At all times when the vehicle is in motion, for all occupants in most states.', difficulty: 'easy' },
  { id: 'pf35', category: 'Traffic Laws', front: 'When must you yield to emergency vehicles?', back: 'Always yield when they have sirens and/or flashing lights. Pull over to the right and stop.', difficulty: 'easy' },
  { id: 'pf36', category: 'Traffic Laws', front: 'What is the minimum following distance behind a fire truck?', back: 'At least 500 feet behind a fire truck responding to an emergency.', difficulty: 'medium' },
  { id: 'pf37', category: 'Traffic Laws', front: 'When is it legal to pass on the right?', back: 'When a vehicle ahead is turning left and there\'s room, or on one-way roads with multiple lanes.', difficulty: 'medium' },
  { id: 'pf38', category: 'Traffic Laws', front: 'When making a right turn on red, what must you do first?', back: 'Come to a complete stop, then yield to all traffic and pedestrians before turning.', difficulty: 'easy' },
  { id: 'pf39', category: 'Traffic Laws', front: 'When are U-turns generally legal?', back: 'Where posted as permitted, or where you can see 500 feet in each direction with no prohibitions.', difficulty: 'medium' },
  { id: 'pf40', category: 'Traffic Laws', front: 'What does a yellow curb mean?', back: 'Stop only long enough to load or unload passengers or freight.', difficulty: 'medium' },
  { id: 'pf41', category: 'Traffic Laws', front: 'What does a white curb mean?', back: 'Stop only long enough to pick up or drop off passengers.', difficulty: 'medium' },
  { id: 'pf42', category: 'Traffic Laws', front: 'What does a green curb mean?', back: 'Parking is permitted for a limited time - check signs for time restrictions.', difficulty: 'medium' },
  { id: 'pf43', category: 'Traffic Laws', front: 'What does a blue curb mean?', back: 'Parking is reserved for disabled persons with a valid disabled parking permit.', difficulty: 'easy' },
  { id: 'pf44', category: 'Traffic Laws', front: 'What does a red curb mean?', back: 'No stopping, standing, or parking at any time.', difficulty: 'easy' },
  { id: 'pf45', category: 'Traffic Laws', front: 'When are headlights required?', back: 'From 30 minutes after sunset until 30 minutes before sunrise, and when visibility is less than 1000 feet.', difficulty: 'medium' },
  { id: 'pf46', category: 'Traffic Laws', front: 'What is the purpose of HOV (diamond) lanes?', back: 'Reserved for vehicles with a minimum number of occupants, typically 2 or more people.', difficulty: 'easy' },
  { id: 'pf47', category: 'Traffic Laws', front: 'What is the minimum age for a learner\'s permit in most states?', back: 'Usually 15-16 years old, with requirements varying by state.', difficulty: 'easy' },
  { id: 'pf48', category: 'Traffic Laws', front: 'What documents must you carry when driving?', back: 'Valid driver\'s license, vehicle registration, and proof of insurance.', difficulty: 'easy' },
  { id: 'pf49', category: 'Traffic Laws', front: 'What is the implied consent law?', back: 'By driving, you agree to submit to chemical testing if suspected of DUI. Refusal can result in license suspension.', difficulty: 'hard' },
  { id: 'pf50', category: 'Traffic Laws', front: 'What is the minimum liability insurance required in most states?', back: 'Varies by state, but typically covers bodily injury and property damage you cause to others.', difficulty: 'medium' },
  { id: 'pf51', category: 'Traffic Laws', front: 'What should you do if you miss your exit on a freeway?', back: 'Continue to the next exit - never back up or make a U-turn on a freeway.', difficulty: 'easy' },
  { id: 'pf52', category: 'Traffic Laws', front: 'What is the fine for not stopping for a school bus?', back: 'Varies by state but typically $250-$500+ and possible license suspension.', difficulty: 'medium' },
  { id: 'pf53', category: 'Traffic Laws', front: 'When can you drive in a bike lane?', back: 'Only when making a turn, entering or leaving a roadway, or parking where permitted.', difficulty: 'medium' },
  { id: 'pf54', category: 'Traffic Laws', front: 'What is the speed limit on most rural interstates?', back: 'Usually 70-75 mph, but varies by state. Always check posted speed limits.', difficulty: 'easy' },
  { id: 'pf55', category: 'Traffic Laws', front: 'What does a flashing red light mean?', back: 'Treat it like a stop sign - come to a complete stop, then proceed when safe.', difficulty: 'easy' },
  { id: 'pf56', category: 'Right-of-Way', front: 'At a four-way stop, who goes first?', back: 'The first vehicle to arrive and stop goes first. If tied, the vehicle on the right goes first.', difficulty: 'medium' },
  { id: 'pf57', category: 'Right-of-Way', front: 'Who has right-of-way at an uncontrolled intersection?', back: 'The vehicle on the right when two vehicles arrive at the same time.', difficulty: 'medium' },
  { id: 'pf58', category: 'Right-of-Way', front: 'When must you yield to pedestrians?', back: 'Always, especially in crosswalks, school zones, and when pedestrians have a walk signal.', difficulty: 'easy' },
  { id: 'pf59', category: 'Right-of-Way', front: 'When entering a roundabout, who must yield?', back: 'Vehicles entering must yield to traffic already circulating in the roundabout.', difficulty: 'medium' },
  { id: 'pf60', category: 'Right-of-Way', front: 'When making a left turn, when must you yield?', back: 'You must yield to oncoming traffic and pedestrians. Turn only when there\'s a safe gap.', difficulty: 'easy' },
  { id: 'pf61', category: 'Right-of-Way', front: 'Who has right-of-way when merging onto a highway?', back: 'Vehicles already on the highway have right-of-way. Entering traffic must merge safely.', difficulty: 'medium' },
  { id: 'pf62', category: 'Right-of-Way', front: 'At a T-intersection with no signs, who has right-of-way?', back: 'Traffic on the through road (the top of the T) has right-of-way.', difficulty: 'medium' },
  { id: 'pf63', category: 'Right-of-Way', front: 'When should you yield to funeral processions?', back: 'Always yield to funeral processions - it\'s illegal to interrupt or pass them in most states.', difficulty: 'easy' },
  { id: 'pf64', category: 'Right-of-Way', front: 'Who has right-of-way at a crosswalk with no traffic signal?', back: 'Pedestrians always have right-of-way in crosswalks. Stop and let them cross.', difficulty: 'easy' },
  { id: 'pf65', category: 'Right-of-Way', front: 'When two vehicles arrive at opposite sides of an intersection, who goes first?', back: 'If both are going straight, they can proceed simultaneously. If one is turning, that driver yields.', difficulty: 'hard' },
  { id: 'pf66', category: 'Right-of-Way', front: 'Who has right-of-way on a narrow mountain road?', back: 'The vehicle going downhill must yield by backing up to a wider space.', difficulty: 'hard' },
  { id: 'pf67', category: 'Right-of-Way', front: 'At a malfunctioning traffic signal, what should you do?', back: 'Treat the intersection as a four-way stop. First to arrive goes first.', difficulty: 'medium' },
  { id: 'pf68', category: 'Right-of-Way', front: 'When should you yield to blind pedestrians?', back: 'Always yield to blind pedestrians carrying a white cane or using a guide dog.', difficulty: 'easy' },
  { id: 'pf69', category: 'Right-of-Way', front: 'At a crosswalk with a pedestrian signal, who has right-of-way?', back: 'Pedestrians have right-of-way when the walk signal is active, even if traffic has a green light.', difficulty: 'medium' },
  { id: 'pf70', category: 'Right-of-Way', front: 'When backing out of a driveway, who must yield?', back: 'The driver backing out must yield to all traffic on the roadway.', difficulty: 'easy' },
  { id: 'pf71', category: 'Right-of-Way', front: 'At an intersection with a yield sign, what should you do?', back: 'Slow down and yield to traffic on the through road. Stop if necessary.', difficulty: 'easy' },
  { id: 'pf72', category: 'Right-of-Way', front: 'When should you yield to transit buses?', back: 'Yield to buses re-entering traffic from a bus stop in some states (check local laws).', difficulty: 'medium' },
  { id: 'pf73', category: 'Right-of-Way', front: 'At an all-way stop, if two cars arrive at exactly the same time, who goes first?', back: 'The car on the right goes first. If facing each other, both can proceed if going straight.', difficulty: 'medium' },
  { id: 'pf74', category: 'Right-of-Way', front: 'When must you stop for a stopped school bus?', back: 'On undivided roads, stop in both directions. On divided roads with median, only your direction stops.', difficulty: 'medium' },
  { id: 'pf75', category: 'Right-of-Way', front: 'Who has right-of-way on a one-lane bridge?', back: 'The vehicle that reaches the bridge first has right-of-way, or the vehicle going uphill on a grade.', difficulty: 'hard' },
  { id: 'pf76', category: 'Safe Driving', front: 'What is the 3-second rule?', back: 'Stay at least 3 seconds behind the vehicle ahead. Count when they pass a fixed object.', difficulty: 'easy' },
  { id: 'pf77', category: 'Safe Driving', front: 'What should you do if you start to skid?', back: 'Take your foot off the gas and steer in the direction you want the front of the car to go.', difficulty: 'easy' },
  { id: 'pf78', category: 'Safe Driving', front: 'What is defensive driving?', back: 'Anticipating potential hazards and being prepared to react to other drivers\' mistakes.', difficulty: 'easy' },
  { id: 'pf79', category: 'Safe Driving', front: 'How do you avoid hydroplaning?', back: 'Slow down on wet roads, avoid standing water, and ensure tires have good tread.', difficulty: 'medium' },
  { id: 'pf80', category: 'Safe Driving', front: 'What is the proper hand position on the steering wheel?', back: '9 and 3 o\'clock positions, or 8 and 4 o\'clock for airbag safety.', difficulty: 'easy' },
  { id: 'pf81', category: 'Safe Driving', front: 'When should you use your hazard lights?', back: 'When stopped on the roadside, driving very slowly, or in hazardous conditions.', difficulty: 'easy' },
  { id: 'pf82', category: 'Safe Driving', front: 'What should you do in dense fog?', back: 'Use low beams, slow down, use right edge line as guide, and consider waiting it out.', difficulty: 'medium' },
  { id: 'pf83', category: 'Safe Driving', front: 'How do you drive safely in rain?', back: 'Reduce speed, increase following distance, use headlights, and avoid sudden movements.', difficulty: 'easy' },
  { id: 'pf84', category: 'Safe Driving', front: 'What is target fixation?', back: 'Looking directly at an obstacle causes you to steer toward it. Look where you want to go instead.', difficulty: 'hard' },
  { id: 'pf85', category: 'Safe Driving', front: 'How do you recover from going off the road?', back: 'Slow down gradually, steer straight, then ease back onto the road when safe.', difficulty: 'medium' },
  { id: 'pf86', category: 'Safe Driving', front: 'What should you check before driving?', back: 'Tires, lights, mirrors, fuel, and adjust seat and mirrors properly.', difficulty: 'easy' },
  { id: 'pf87', category: 'Safe Driving', front: 'How do you share the road with motorcycles?', back: 'Check blind spots, give full lane width, and be aware they may be closer than they appear.', difficulty: 'medium' },
  { id: 'pf88', category: 'Safe Driving', front: 'What is the danger of driving while drowsy?', back: 'Drowsy driving impairs reaction time and judgment similar to alcohol. Pull over if tired.', difficulty: 'easy' },
  { id: 'pf89', category: 'Safe Driving', front: 'How do you handle a tire blowout?', back: 'Grip the wheel, ease off gas, don\'t brake hard, and steer to the shoulder safely.', difficulty: 'hard' },
  { id: 'pf90', category: 'Safe Driving', front: 'What should you do at a flashing yellow light?', back: 'Slow down and proceed with caution. You don\'t need to stop.', difficulty: 'easy' },
  { id: 'pf91', category: 'Safe Driving', front: 'How do you share the road with large trucks?', back: 'Avoid blind spots (no-zones), don\'t cut them off, and give extra space for their turns.', difficulty: 'medium' },
  { id: 'pf92', category: 'Safe Driving', front: 'What is the proper way to parallel park?', back: 'Align with front car, reverse while turning wheel, straighten when clear, adjust as needed.', difficulty: 'medium' },
  { id: 'pf93', category: 'Safe Driving', front: 'When should you use high beams?', back: 'On dark roads with no oncoming traffic. Dim them within 500 feet of approaching vehicles.', difficulty: 'easy' },
  { id: 'pf94', category: 'Safe Driving', front: 'How do you drive safely in snow or ice?', back: 'Reduce speed significantly, increase following distance, brake gently, and avoid sudden movements.', difficulty: 'easy' },
  { id: 'pf95', category: 'Safe Driving', front: 'What should you do if your brakes fail?', back: 'Pump brakes if non-ABS, use parking brake slowly, shift to lower gear, find a safe place to stop.', difficulty: 'hard' },
  { id: 'pf96', category: 'Safe Driving', front: 'How do you handle an aggressive driver?', back: 'Stay calm, don\'t engage, let them pass, avoid eye contact, and call police if threatened.', difficulty: 'medium' },
  { id: 'pf97', category: 'Safe Driving', front: 'What is the proper following distance in bad weather?', back: 'Increase to 4-6 seconds or more, depending on conditions.', difficulty: 'easy' },
  { id: 'pf98', category: 'Safe Driving', front: 'How do you navigate a roundabout?', back: 'Yield to circulating traffic, go counterclockwise, use turn signal when exiting.', difficulty: 'medium' },
  { id: 'pf99', category: 'Safe Driving', front: 'What should you do if your car overheats?', back: 'Turn off AC, turn on heat to draw heat from engine, pull over safely, don\'t open radiator cap when hot.', difficulty: 'medium' },
  { id: 'pf100', category: 'Safe Driving', front: 'What is the most important rule of driving?', back: 'Safety first - always be alert, follow traffic laws, and never drive impaired or distracted.', difficulty: 'easy' }
];

// ==================== PERMIT TEST DATA ====================
const permitTestQuestions = [
  { id: 'pt1', category: 'Traffic Laws', question: 'What is the legal blood alcohol concentration (BAC) limit for drivers 21 and over?', options: ['0.04%', '0.08%', '0.10%', '0.12%'], correctIndex: 1, explanation: 'The legal BAC limit is 0.08% for drivers 21 and over in most states.' },
  { id: 'pt2', category: 'Traffic Laws', question: 'When must you stop for a school bus with flashing red lights?', options: ['Only if children are visible', 'Only in your direction of travel', 'On both sides of undivided roads', 'Never on weekends'], correctIndex: 2, explanation: 'On undivided roads, you must stop in both directions when a school bus has flashing red lights.' },
  { id: 'pt3', category: 'Road Signs', question: 'What does a red octagonal sign mean?', options: ['Yield', 'Stop', 'Speed limit', 'No entry'], correctIndex: 1, explanation: 'A red octagon is always a STOP sign.' },
  { id: 'pt4', category: 'Right-of-Way', question: 'At a four-way stop, who has the right-of-way?', options: ['The largest vehicle', 'The vehicle on the left', 'The first vehicle to arrive and stop', 'The vehicle with the most passengers'], correctIndex: 2, explanation: 'At a four-way stop, the first vehicle to arrive and stop has the right-of-way.' },
  { id: 'pt5', category: 'Traffic Laws', question: 'What is the speed limit in a school zone when children are present?', options: ['10 mph', '15-25 mph (posted)', '35 mph', '45 mph'], correctIndex: 1, explanation: 'School zone speed limits are typically 15-25 mph when children are present - always check posted signs.' },
  { id: 'pt6', category: 'Safe Driving', question: 'What is the minimum following distance you should maintain behind another vehicle?', options: ['1 second', '2 seconds', '3 seconds', '5 seconds'], correctIndex: 2, explanation: 'The 3-second rule provides adequate stopping distance in normal conditions.' },
  { id: 'pt7', category: 'Road Signs', question: 'What does a yellow diamond-shaped sign indicate?', options: ['Regulatory information', 'Warning of potential hazards', 'Guide information', 'Construction only'], correctIndex: 1, explanation: 'Yellow diamond-shaped signs warn of potential hazards ahead.' },
  { id: 'pt8', category: 'Traffic Laws', question: 'When are headlights required?', options: ['Only at night', '30 min after sunset to 30 min before sunrise and when visibility is poor', 'Only in rain', 'Only on highways'], correctIndex: 1, explanation: 'Headlights are required from 30 minutes after sunset until 30 minutes before sunrise, and when visibility is less than 1000 feet.' },
  { id: 'pt9', category: 'Right-of-Way', question: 'When making a left turn at an intersection, you must yield to:', options: ['Only pedestrians', 'Only oncoming traffic', 'Oncoming traffic and pedestrians', 'No one if you have a green light'], correctIndex: 2, explanation: 'When turning left, you must yield to oncoming traffic and pedestrians.' },
  { id: 'pt10', category: 'Traffic Laws', question: 'What does a flashing red light mean?', options: ['Proceed with caution', 'Stop, then proceed when safe', 'Slow down', 'Road closed'], correctIndex: 1, explanation: 'A flashing red light is treated like a stop sign - come to a complete stop, then proceed when safe.' },
  { id: 'pt11', category: 'Safe Driving', question: 'What should you do if your vehicle starts to hydroplane?', options: ['Brake hard immediately', 'Accelerate to gain traction', 'Ease off the gas and steer straight', 'Turn the wheel sharply'], correctIndex: 2, explanation: 'When hydroplaning, ease off the gas, don\'t brake, and steer straight until you regain traction.' },
  { id: 'pt12', category: 'Road Signs', question: 'What does a pentagon-shaped sign indicate?', options: ['Construction zone', 'School zone or crossing', 'No passing zone', 'Railroad crossing'], correctIndex: 1, explanation: 'Pentagon-shaped signs indicate school zones or school crossings.' },
  { id: 'pt13', category: 'Traffic Laws', question: 'What documents must you carry when driving?', options: ['Just your license', 'License and registration only', 'License, registration, and proof of insurance', 'No documents required for short trips'], correctIndex: 2, explanation: 'You must carry a valid driver\'s license, vehicle registration, and proof of insurance.' },
  { id: 'pt14', category: 'Right-of-Way', question: 'Who has the right-of-way when entering a roundabout?', options: ['Entering traffic', 'Traffic already in the roundabout', 'Larger vehicles', 'Emergency vehicles only'], correctIndex: 1, explanation: 'Traffic already circulating in the roundabout has the right-of-way.' },
  { id: 'pt15', category: 'Safe Driving', question: 'What should you do if you miss your exit on a highway?', options: ['Back up to the exit', 'Make a U-turn on the shoulder', 'Continue to the next exit', 'Stop and wait for help'], correctIndex: 2, explanation: 'Never back up or make U-turns on highways. Continue to the next exit.' },
  { id: 'pt16', category: 'Traffic Laws', question: 'What is the implied consent law?', options: ['You agree to follow all traffic laws', 'You agree to submit to chemical testing if suspected of DUI', 'You consent to vehicle searches', 'You agree to pay all fines'], correctIndex: 1, explanation: 'Implied consent means by driving, you agree to submit to chemical testing if suspected of DUI.' },
  { id: 'pt17', category: 'Road Signs', question: 'What does a red circle with a white horizontal bar mean?', options: ['Speed limit ahead', 'Do not enter', 'No parking', 'Yield ahead'], correctIndex: 1, explanation: 'A red circle with a white horizontal bar means DO NOT ENTER.' },
  { id: 'pt18', category: 'Safe Driving', question: 'When driving in fog, you should use:', options: ['High beam headlights', 'Low beam headlights', 'Parking lights only', 'No lights'], correctIndex: 1, explanation: 'Use low beam headlights in fog - high beams reflect off the fog and reduce visibility.' },
  { id: 'pt19', category: 'Right-of-Way', question: 'At an uncontrolled intersection (no signs or signals), who has the right-of-way?', options: ['The vehicle on the left', 'The vehicle on the right', 'The faster vehicle', 'The larger vehicle'], correctIndex: 1, explanation: 'At an uncontrolled intersection, the vehicle on the right has the right-of-way.' },
  { id: 'pt20', category: 'Traffic Laws', question: 'When making a right turn on red, you must:', options: ['Just slow down and turn', 'Stop first, then yield to traffic and pedestrians before turning', 'Wait for the green light', 'Honk before turning'], correctIndex: 1, explanation: 'You must come to a complete stop, then yield to all traffic and pedestrians before turning right on red.' },
  { id: 'pt21', category: 'Road Signs', question: 'What does an orange diamond-shaped sign indicate?', options: ['School zone', 'Construction or maintenance zone', 'No passing zone', 'Speed limit change'], correctIndex: 1, explanation: 'Orange diamond-shaped signs indicate construction or maintenance zones.' },
  { id: 'pt22', category: 'Safe Driving', question: 'What is the proper hand position on the steering wheel?', options: ['10 and 2 o\'clock', '9 and 3 o\'clock (or 8 and 4)', 'One hand at 12 o\'clock', 'Both hands at 6 o\'clock'], correctIndex: 1, explanation: '9 and 3 o\'clock (or 8 and 4) is recommended for airbag safety and control.' },
  { id: 'pt23', category: 'Traffic Laws', question: 'How far must you stop from a railroad crossing?', options: ['5-10 feet', '15-50 feet', '100 feet', '200 feet'], correctIndex: 1, explanation: 'You must stop at least 15 feet but no more than 50 feet from the nearest rail.' },
  { id: 'pt24', category: 'Right-of-Way', question: 'When must you yield to emergency vehicles?', options: ['Only when they honk', 'Only at intersections', 'Always when they have sirens and/or flashing lights', 'Only on highways'], correctIndex: 2, explanation: 'Always yield to emergency vehicles with active sirens and/or flashing lights - pull over and stop.' },
  { id: 'pt25', category: 'Road Signs', question: 'What does a green arrow traffic signal mean?', options: ['Yield to pedestrians', 'Proceed in the direction shown - protected turn', 'Slow down', 'Prepare to stop'], correctIndex: 1, explanation: 'A green arrow means you have a protected turn - proceed in the direction shown.' },
  { id: 'pt26', category: 'Safe Driving', question: 'What is target fixation?', options: ['Focusing on your destination', 'Looking at an obstacle causes you to steer toward it', 'Checking your mirrors', 'Watching for police'], correctIndex: 1, explanation: 'Target fixation is when looking at an obstacle causes you to steer toward it - look where you want to go.' },
  { id: 'pt27', category: 'Traffic Laws', question: 'What does a yellow curb mean?', options: ['No parking', 'Loading/unloading only', 'Disabled parking only', 'Short-term parking'], correctIndex: 1, explanation: 'A yellow curb means stop only long enough to load or unload passengers or freight.' },
  { id: 'pt28', category: 'Right-of-Way', question: 'When two vehicles arrive at opposite sides of a four-way stop at the same time:', options: ['The larger vehicle goes first', 'Both can proceed simultaneously if going straight', 'The vehicle turning left goes first', 'The vehicle on the left goes first'], correctIndex: 1, explanation: 'If both vehicles are going straight, they can proceed simultaneously. If one is turning, that driver yields.' },
  { id: 'pt29', category: 'Road Signs', question: 'What does a flashing yellow light mean?', options: ['Stop completely', 'Proceed with caution', 'Yield to all traffic', 'Road closed ahead'], correctIndex: 1, explanation: 'A flashing yellow light means slow down and proceed with caution.' },
  { id: 'pt30', category: 'Safe Driving', question: 'How should you share the road with large trucks?', options: ['Pass quickly on the right', 'Stay in their blind spots', 'Avoid their blind spots and give extra space', 'Follow closely to draft'], correctIndex: 2, explanation: 'Avoid trucks\' blind spots (no-zones), don\'t cut them off, and give them extra space for turns.' },
  { id: 'pt31', category: 'Traffic Laws', question: 'When must you use your turn signal?', options: ['Only on highways', 'Only when other cars are present', 'At least 100 feet before turning or changing lanes', 'Only at night'], correctIndex: 2, explanation: 'Signal at least 100 feet before turning or changing lanes in most states.' },
  { id: 'pt32', category: 'Right-of-Way', question: 'When entering a highway from an on-ramp, you should:', options: ['Stop at the end of the ramp', 'Accelerate to match highway speed and merge smoothly', 'Expect traffic to yield to you', 'Drive on the shoulder until you find a gap'], correctIndex: 1, explanation: 'Use the acceleration lane to reach highway speed, then merge when safe.' },
  { id: 'pt33', category: 'Road Signs', question: 'What does a brown sign with white text indicate?', options: ['Construction ahead', 'Recreational or cultural interest areas', 'Speed limit', 'Hospital ahead'], correctIndex: 1, explanation: 'Brown signs point to parks, historical sites, and other recreational/cultural attractions.' },
  { id: 'pt34', category: 'Safe Driving', question: 'What should you do if your brakes fail?', options: ['Turn off the engine immediately', 'Pump the brakes, use parking brake slowly, shift to lower gear', 'Jump out of the car', 'Steer into oncoming traffic'], correctIndex: 1, explanation: 'Pump brakes (if non-ABS), use parking brake slowly, shift to lower gear, and find a safe place to stop.' },
  { id: 'pt35', category: 'Traffic Laws', question: 'What is the "Move Over" law?', options: ['Move over for faster traffic', 'Move over or slow down for emergency vehicles with flashing lights', 'Move over for pedestrians', 'Move over in construction zones only'], correctIndex: 1, explanation: 'Move over one lane or slow down significantly when passing emergency vehicles with flashing lights.' },
  { id: 'pt36', category: 'Right-of-Way', question: 'At a T-intersection with no signs, who has the right-of-way?', options: ['The vehicle turning', 'Traffic on the through road (top of T)', 'The vehicle arriving first', 'The vehicle on the left'], correctIndex: 1, explanation: 'At a T-intersection, traffic on the through road has the right-of-way.' },
  { id: 'pt37', category: 'Road Signs', question: 'What does a circular sign typically indicate?', options: ['Speed limit', 'Railroad crossing ahead', 'School zone', 'Construction zone'], correctIndex: 1, explanation: 'Circular signs typically indicate railroad crossings ahead.' },
  { id: 'pt38', category: 'Safe Driving', question: 'What should you do if you start to skid?', options: ['Brake hard immediately', 'Accelerate to regain control', 'Take foot off gas and steer in the direction you want to go', 'Turn the wheel in the opposite direction of the skid'], correctIndex: 2, explanation: 'Take your foot off the gas, don\'t brake, and steer in the direction you want the front of the car to go.' },
  { id: 'pt39', category: 'Traffic Laws', question: 'What is the minimum age for a learner\'s permit in most states?', options: ['14 years old', '15-16 years old', '17 years old', '18 years old'], correctIndex: 1, explanation: 'Most states allow you to get a learner\'s permit at age 15 or 16, with requirements varying by state.' },
  { id: 'pt40', category: 'Right-of-Way', question: 'At a malfunctioning traffic signal, what should you do?', options: ['Proceed cautiously without stopping', 'Treat it as a four-way stop', 'Assume you have the right-of-way', 'Wait for police to arrive'], correctIndex: 1, explanation: 'Treat a malfunctioning traffic signal as a four-way stop - first to arrive, first to go.' }
];

// ==================== SCENARIO DATA ====================
const scenarioQuestions = [
  { id: 'sq1', topic: 'Parallel Parking', scenario: 'You need to parallel park between two cars on a busy street. There\'s about 1.5 car lengths of space.', question: 'What is your first step after stopping beside the front car?', options: ['Turn wheel sharply right and reverse immediately', 'Align your rear bumper with the front car\'s rear bumper, then reverse slowly', 'Signal and drive forward to find a bigger space', 'Wait for traffic to clear before starting'], correctIndex: 1, explanation: 'Align your rear bumper with the front car\'s rear bumper, about 2-3 feet away from it, before beginning to reverse.', difficulty: 'medium' },
  { id: 'sq2', topic: 'Parallel Parking', scenario: 'During parallel parking, you\'ve backed in but are 24 inches from the curb - too far.', question: 'What should you do?', options: ['Start over from the beginning', 'Pull forward slightly while turning right, then reverse while turning left to adjust', 'Open your door to check the distance', 'Accept the parking job as is'], correctIndex: 1, explanation: 'You can adjust by pulling forward slightly while turning toward the curb, then reversing while turning away from it.', difficulty: 'medium' },
  { id: 'sq3', topic: 'Parallel Parking', scenario: 'There\'s a car waiting behind you while you try to parallel park.', question: 'What should you do?', options: ['Rush to finish quickly', 'Take your time and park correctly', 'Give up and drive away', 'Wave them to go around you'], correctIndex: 1, explanation: 'Don\'t let pressure rush you. Take the time you need to park correctly. Use hazard lights if needed.', difficulty: 'easy' },
  { id: 'sq4', topic: 'Parallel Parking', scenario: 'You accidentally hit the curb while parallel parking. Your tire is touching the curb.', question: 'Is this an automatic fail on a driving test?', options: ['Yes, any curb contact is an automatic fail', 'No, but you should correct it before finishing', 'Only if you hit the curb hard', 'It depends on the examiner'], correctIndex: 1, explanation: 'Light curb contact isn\'t always an automatic fail, but you should correct it. Rolling up onto the curb would likely fail you.', difficulty: 'medium' },
  { id: 'sq5', topic: 'Highway Driving', scenario: 'You\'re merging onto a highway and the acceleration lane is ending. Traffic is moving at 65 mph.', question: 'What should you do?', options: ['Stop at the end of the ramp and wait for a gap', 'Accelerate to match traffic speed and merge smoothly', 'Drive on the shoulder until you find a gap', 'Slow down and let traffic pass before merging'], correctIndex: 1, explanation: 'Use the acceleration lane to reach highway speed, then merge when safe. Stopping is dangerous and illegal in most places.', difficulty: 'easy' },
  { id: 'sq6', topic: 'Highway Driving', scenario: 'You\'re in the right lane of a highway and see a car merging ahead from an on-ramp.', question: 'What should you do?', options: ['Maintain your speed and make them adjust', 'Change lanes if safe, or adjust your speed to create a gap', 'Speed up to pass them quickly', 'Slow down significantly'], correctIndex: 1, explanation: 'Change lanes if possible, or adjust speed to create space. Be courteous and predictable.', difficulty: 'easy' },
  { id: 'sq7', topic: 'Highway Driving', scenario: 'You miss your exit on the highway. There\'s an emergency turnaround nearby.', question: 'What should you do?', options: ['Use the emergency turnaround', 'Back up carefully on the shoulder', 'Continue to the next exit', 'Make a U-turn at the next crossover'], correctIndex: 2, explanation: 'Never use emergency turnarounds or back up on highways. Continue to the next exit.', difficulty: 'easy' },
  { id: 'sq8', topic: 'Highway Driving', scenario: 'You\'re driving in heavy highway traffic and need to exit in 2 miles. You\'re in the left lane.', question: 'When should you move to the right lane?', options: ['Stay in the left lane until the last moment', 'Move right as soon as it\'s safe', 'Only move right when you see your exit', 'It doesn\'t matter as long as you exit in time'], correctIndex: 1, explanation: 'Move to the right lane well before your exit. This gives you time to react and is safer in heavy traffic.', difficulty: 'easy' },
  { id: 'sq9', topic: 'Adverse Conditions', scenario: 'It\'s raining heavily and water is pooling on the road. Your car starts to hydroplane.', question: 'What should you do?', options: ['Brake hard to slow down', 'Steer sharply toward the shoulder', 'Ease off the gas and steer straight', 'Accelerate to push through the water'], correctIndex: 2, explanation: 'Ease off the gas, don\'t brake, and steer straight. Sudden movements can cause loss of control.', difficulty: 'hard' },
  { id: 'sq10', topic: 'Adverse Conditions', scenario: 'You\'re driving in dense fog and visibility is less than 200 feet.', question: 'What should you do?', options: ['Use high beams to see further', 'Use low beams and reduce speed significantly', 'Follow the taillights of the car ahead closely', 'Pull over and stop immediately'], correctIndex: 1, explanation: 'Use low beams (high beams reflect off fog), slow down, and use road lines as guides. If too dense, find a safe place to stop.', difficulty: 'medium' },
  { id: 'sq11', topic: 'Adverse Conditions', scenario: 'You encounter black ice on a curve and your car starts to skid.', question: 'What should you do?', options: ['Brake firmly to stop the skid', 'Steer in the opposite direction of the skid', 'Take your foot off the gas and steer in the direction you want to go', 'Accelerate to regain traction'], correctIndex: 2, explanation: 'Take your foot off the gas, don\'t brake, and steer gently in the direction you want the car to go.', difficulty: 'hard' },
  { id: 'sq12', topic: 'Adverse Conditions', scenario: 'It\'s night and raining. An oncoming vehicle has their high beams on, blinding you.', question: 'What should you do?', options: ['Flash your high beams back at them', 'Look toward the right edge of the road', 'Close your eyes momentarily', 'Speed up to pass them quickly'], correctIndex: 1, explanation: 'Look toward the right edge of your lane to avoid the glare. Use the road edge or line as a guide.', difficulty: 'medium' },
  { id: 'sq13', topic: 'Intersections', scenario: 'You arrive at a four-way stop at the same time as a car on your right and a car across from you.', question: 'Who goes first?', options: ['You go first since you arrived at the same time', 'The car on your right goes first', 'The car across from you goes first', 'Everyone goes at once'], correctIndex: 1, explanation: 'At a four-way stop, the car on the right has right-of-way when vehicles arrive simultaneously.', difficulty: 'medium' },
  { id: 'sq14', topic: 'Intersections', scenario: 'You\'re waiting to turn left at a green light. The light turns yellow, then red. There are still cars in the intersection.', question: 'What should you do?', options: ['Complete your turn quickly before cross traffic starts', 'Wait until the intersection is clear, then turn', 'Back up to the stop line', 'Wait for the next green light'], correctIndex: 1, explanation: 'Complete your turn only when the intersection is clear. You legally entered on green, so finish your turn safely.', difficulty: 'medium' },
  { id: 'sq15', topic: 'Intersections', scenario: 'The traffic light is not working at a busy intersection. There are no police directing traffic.', question: 'How should you proceed?', options: ['Drive through without stopping', 'Treat it as a four-way stop', 'Yield only to vehicles on your left', 'Wait for someone to direct traffic'], correctIndex: 1, explanation: 'Treat a malfunctioning traffic signal as a four-way stop. First to arrive, first to go.', difficulty: 'easy' },
  { id: 'sq16', topic: 'Intersections', scenario: 'You\'re turning right on red after stopping. A pedestrian is waiting to cross your path.', question: 'What should you do?', options: ['Turn quickly before they enter the crosswalk', 'Wait for the pedestrian to cross', 'Honk to alert them you\'re turning', 'Edge forward to show you\'re turning'], correctIndex: 1, explanation: 'Always yield to pedestrians. Wait until they have safely crossed before turning.', difficulty: 'easy' },
  { id: 'sq17', topic: 'Emergency Vehicles', scenario: 'You hear a siren approaching from behind but can\'t see the emergency vehicle yet.', question: 'What should you do?', options: ['Continue at your current speed', 'Pull over to the right and stop immediately', 'Speed up to get out of the way', 'Stop in your current lane'], correctIndex: 1, explanation: 'Pull over to the right and stop. Wait until you can determine where the vehicle is coming from.', difficulty: 'easy' },
  { id: 'sq18', topic: 'Emergency Vehicles', scenario: 'An ambulance is stopped with lights flashing in the lane next to you on a two-lane road.', question: 'What should you do?', options: ['Continue at normal speed', 'Slow down and pass carefully', 'Move over a lane if possible, or slow down significantly', 'Stop and wait for them to leave'], correctIndex: 2, explanation: 'Move over law requires you to change lanes if possible, or slow down significantly when passing emergency vehicles.', difficulty: 'easy' },
  { id: 'sq19', topic: 'School Zones', scenario: 'You approach a school zone with flashing yellow lights and children are present.', question: 'What should you do?', options: ['Continue at the normal speed limit', 'Reduce speed to the posted school zone limit', 'Only slow down if children are in the road', 'Speed up to pass through quickly'], correctIndex: 1, explanation: 'Always reduce speed to the posted limit when school zone lights are flashing and children are present.', difficulty: 'easy' },
  { id: 'sq20', topic: 'School Zones', scenario: 'A school bus has stopped with red lights flashing on the opposite side of a divided highway with a median.', question: 'Do you need to stop?', options: ['Yes, always stop for school buses', 'No, you can proceed with caution', 'Only stop if children are crossing', 'Stop only if the bus driver signals you'], correctIndex: 1, explanation: 'On a divided highway with a median, you don\'t need to stop, but proceed with caution.', difficulty: 'medium' }
];

// ==================== STATE ====================
let progress = {
  permitFlashcards: { seen: [], known: [], needsPractice: [] },
  permitTest: { testsTaken: 0, passedTests: 0, averageScore: 0, highScore: 0 },
  scenarioTest: { testsTaken: 0, passedTests: 0, averageScore: 0, highScore: 0 },
  totalStudyTime: 0,
  lastSession: new Date().toISOString()
};

let session = {
  permitTest: null,
  scenarioTest: null,
  permitFlashcards: null
};

let currentDeck = [...permitFlashcards];
let currentCardIndex = 0;
let isFlipped = false;
let currentCategory = 'all';
let testQuestions = [];
let testIndex = 0;
let testAnswers = [];
let testTime = 45 * 60;
let testTimer = null;
let selectedTestAnswer = null;
let testFinished = false;
let scenarioIndex = 0;
let scenarioAnswers = [];
let selectedScenarioAnswer = null;
let scenarioFinished = false;

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
  loadProgress();
  loadSession();
  updateHomeProgress();
  checkResumeBanner();
});

function loadProgress() {
  const saved = localStorage.getItem('driveyourtest_progress');
  if (saved) {
    progress = { ...progress, ...JSON.parse(saved) };
  }
}

function saveProgress() {
  progress.lastSession = new Date().toISOString();
  localStorage.setItem('driveyourtest_progress', JSON.stringify(progress));
}

function loadSession() {
  const saved = localStorage.getItem('driveyourtest_session');
  if (saved) {
    session = { ...session, ...JSON.parse(saved) };
  }
}

function saveSession() {
  localStorage.setItem('driveyourtest_session', JSON.stringify(session));
}

function clearSession() {
  session = { permitTest: null, scenarioTest: null, permitFlashcards: null };
  localStorage.removeItem('driveyourtest_session');
}

function clearSessionAndRefresh() {
  clearSession();
  location.reload();
}

function checkResumeBanner() {
  const banner = document.getElementById('resume-banner');
  if (session.permitTest?.active || session.scenarioTest?.active) {
    banner.classList.remove('hidden');
  }
}

// ==================== NAVIGATION ====================
function showView(viewId) {
  document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
  document.getElementById(viewId + '-view').classList.add('active');
}

function goHome() {
  if (testTimer) clearInterval(testTimer);
  showView('home');
  updateHomeProgress();
}

function confirmExit() {
  if (confirm('Are you sure you want to exit? Your progress will be saved.')) goHome();
}

function updateHomeProgress() {
  const seenCount = progress.permitFlashcards.seen.length;
  const knownCount = progress.permitFlashcards.known.length;
  const flashcardPct = Math.round((knownCount / 100) * 100);
  
  document.getElementById('flashcard-progress').textContent = flashcardPct + '%';
  document.getElementById('flashcard-bar').style.width = flashcardPct + '%';
  document.getElementById('flashcard-badge').textContent = flashcardPct + '%';
  
  document.getElementById('permit-tests').textContent = progress.permitTest.testsTaken;
  document.getElementById('best-score').textContent = progress.permitTest.highScore > 0 ? progress.permitTest.highScore + '%' : '-';
  
  document.getElementById('scenario-tests').textContent = progress.scenarioTest.testsTaken;
  document.getElementById('scenario-best').textContent = progress.scenarioTest.highScore > 0 ? progress.scenarioTest.highScore + '%' : '-';
}

// ==================== FLASHCARDS ====================
function startFlashcards() {
  if (session.permitFlashcards) {
    currentCategory = session.permitFlashcards.category || 'all';
    currentCardIndex = session.permitFlashcards.index || 0;
  } else {
    currentCategory = 'all';
    currentCardIndex = 0;
  }
  
  selectCategory(currentCategory);
  showView('flashcards');
}

function selectCategory(category) {
  currentCategory = category;
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.category === category);
  });
  
  if (category === 'all') {
    currentDeck = [...permitFlashcards];
  } else {
    currentDeck = permitFlashcards.filter(c => c.category === category);
  }
  
  if (currentCardIndex >= currentDeck.length) currentCardIndex = 0;
  
  document.getElementById('card-total').textContent = currentDeck.length;
  isFlipped = false;
  updateFlashcard();
  saveFlashcardSession();
}

function updateFlashcard() {
  const card = currentDeck[currentCardIndex];
  const flashcard = document.getElementById('flashcard');
  
  flashcard.classList.remove('flipped');
  isFlipped = false;
  
  document.getElementById('card-category').textContent = card.category;
  document.getElementById('card-front').textContent = card.front;
  document.getElementById('card-back').textContent = card.back;
  document.getElementById('card-index').textContent = currentCardIndex + 1;
  
  document.getElementById('prev-btn').disabled = currentCardIndex === 0;
  document.getElementById('next-btn').disabled = currentCardIndex === currentDeck.length - 1;
}

function flipCard() {
  isFlipped = !isFlipped;
  document.getElementById('flashcard').classList.toggle('flipped', isFlipped);
}

function prevCard() {
  if (currentCardIndex > 0) {
    currentCardIndex--;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function nextCard() {
  if (currentCardIndex < currentDeck.length - 1) {
    currentCardIndex++;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function rateCard(rating) {
  const card = currentDeck[currentCardIndex];
  
  if (!progress.permitFlashcards.seen.includes(card.id)) {
    progress.permitFlashcards.seen.push(card.id);
  }
  
  if (rating === 'known') {
    if (!progress.permitFlashcards.known.includes(card.id)) {
      progress.permitFlashcards.known.push(card.id);
    }
    progress.permitFlashcards.needsPractice = progress.permitFlashcards.needsPractice.filter(id => id !== card.id);
  } else {
    if (!progress.permitFlashcards.needsPractice.includes(card.id)) {
      progress.permitFlashcards.needsPractice.push(card.id);
    }
    progress.permitFlashcards.known = progress.permitFlashcards.known.filter(id => id !== card.id);
  }
  
  saveProgress();
  
  if (currentCardIndex < currentDeck.length - 1) {
    currentCardIndex++;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function saveFlashcardSession() {
  session.permitFlashcards = { category: currentCategory, index: currentCardIndex };
  saveSession();
}

// ==================== PERMIT TEST ====================
function startPermitTest() {
  if (session.permitTest?.active) {
    testQuestions = session.permitTest.questions;
    testIndex = session.permitTest.index;
    testAnswers = session.permitTest.answers;
    selectedTestAnswer = session.permitTest.selectedAnswer;
    testTime = session.permitTest.timeLeft;
    testFinished = false;
  } else {
    testQuestions = [...permitTestQuestions].sort(() => Math.random() - 0.5);
    testIndex = 0;
    testAnswers = new Array(testQuestions.length).fill(null);
    testTime = 45 * 60;
    selectedTestAnswer = null;
    testFinished = false;
  }
  
  showView('permit-test');
  document.getElementById('test-results').classList.add('hidden');
  document.getElementById('test-question-card').classList.remove('hidden');
  document.getElementById('test-actions').classList.remove('hidden');
  document.getElementById('test-total').textContent = testQuestions.length;
  
  updateTimerDisplay();
  startTimer();
  displayTestQuestion();
  saveTestSession();
}

function startTimer() {
  if (testTimer) clearInterval(testTimer);
  testTimer = setInterval(() => {
    testTime--;
    updateTimerDisplay();
    saveTestSession();
    if (testTime <= 0) {
      clearInterval(testTimer);
      finishTest();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const mins = Math.floor(testTime / 60);
  const secs = testTime % 60;
  document.getElementById('test-timer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
}

function displayTestQuestion() {
  const q = testQuestions[testIndex];
  document.getElementById('test-category').textContent = q.category;
  document.getElementById('test-question').textContent = q.question;
  document.getElementById('test-index').textContent = testIndex + 1;
  document.getElementById('test-progress-bar').style.width = ((testIndex + 1) / testQuestions.length) * 100 + '%';
  
  const optionsContainer = document.getElementById('test-options');
  optionsContainer.innerHTML = '';
  
  const isAnswered = testAnswers[testIndex] !== null;
  
  q.options.forEach((opt, i) => {
    const item = document.createElement('div');
    item.className = 'option-item';
    if (isAnswered) {
      item.classList.add('disabled');
      if (i === q.correctIndex) item.classList.add('correct');
      else if (i === testAnswers[testIndex]) item.classList.add('incorrect');
    } else if (selectedTestAnswer === i) {
      item.classList.add('selected');
    }
    item.innerHTML = `<div class="option-radio"></div><span class="option-text">${opt}</span>`;
    if (!isAnswered) item.onclick = () => selectTestOption(i);
    optionsContainer.appendChild(item);
  });
  
  if (isAnswered) {
    const explanation = document.createElement('div');
    explanation.className = 'explanation';
    explanation.innerHTML = `<div class="explanation-title">Explanation</div><div class="explanation-text">${q.explanation}</div>`;
    optionsContainer.appendChild(explanation);
  }
  
  document.getElementById('submit-btn').classList.toggle('hidden', isAnswered);
  document.getElementById('submit-btn').disabled = selectedTestAnswer === null && !isAnswered;
  document.getElementById('next-question-btn').classList.toggle('hidden', !isAnswered);
  document.getElementById('next-question-btn').textContent = testIndex === testQuestions.length - 1 && isAnswered ? 'See Results ‚Üí' : 'Next Question ‚Üí';
}

function selectTestOption(index) {
  if (testAnswers[testIndex] !== null) return;
  selectedTestAnswer = index;
  displayTestQuestion();
  saveTestSession();
}

function submitTestAnswer() {
  if (selectedTestAnswer === null) return;
  testAnswers[testIndex] = selectedTestAnswer;
  displayTestQuestion();
  saveTestSession();
}

function nextTestQuestion() {
  if (testIndex < testQuestions.length - 1) {
    testIndex++;
    selectedTestAnswer = testAnswers[testIndex];
    displayTestQuestion();
    saveTestSession();
  } else {
    finishTest();
  }
}

function finishTest() {
  if (testTimer) clearInterval(testTimer);
  testFinished = true;
  
  const correct = testAnswers.filter((a, i) => a === testQuestions[i].correctIndex).length;
  const total = testQuestions.length;
  const score = Math.round((correct / total) * 100);
  const passed = score >= 80;
  
  document.getElementById('test-question-card').classList.add('hidden');
  document.getElementById('test-actions').classList.add('hidden');
  document.getElementById('test-results').classList.remove('hidden');
  
  document.getElementById('results-icon').textContent = passed ? 'üéâ' : 'üìö';
  document.getElementById('results-title').textContent = passed ? 'Congratulations!' : 'Keep Practicing!';
  document.getElementById('results-title').style.color = passed ? '#059669' : '#dc2626';
  document.getElementById('results-score').textContent = score + '%';
  document.getElementById('results-score').style.color = passed ? '#059669' : '#dc2626';
  document.getElementById('correct-count').textContent = correct;
  document.getElementById('incorrect-count').textContent = total - correct;
  
  progress.permitTest.testsTaken++;
  progress.permitTest.averageScore = Math.round((progress.permitTest.averageScore * (progress.permitTest.testsTaken - 1) + score) / progress.permitTest.testsTaken);
  if (score > progress.permitTest.highScore) progress.permitTest.highScore = score;
  if (passed) progress.permitTest.passedTests++;
  saveProgress();
  
  session.permitTest = null;
  saveSession();
}

function saveTestSession() {
  session.permitTest = {
    active: !testFinished,
    questions: testQuestions,
    index: testIndex,
    answers: testAnswers,
    selectedAnswer: selectedTestAnswer,
    timeLeft: testTime
  };
  saveSession();
}

// ==================== SCENARIOS ====================
function startScenarios() {
  if (session.scenarioTest?.active) {
    scenarioIndex = session.scenarioTest.index;
    scenarioAnswers = session.scenarioTest.answers;
    selectedScenarioAnswer = session.scenarioTest.selectedAnswer;
  } else {
    scenarioIndex = 0;
    scenarioAnswers = new Array(scenarioQuestions.length).fill(null);
    selectedScenarioAnswer = null;
  }
  scenarioFinished = false;
  
  showView('scenarios');
  document.getElementById('scenario-results').classList.add('hidden');
  document.getElementById('scenario-card').classList.remove('hidden');
  document.getElementById('scenario-question-card').classList.remove('hidden');
  document.getElementById('scenario-actions').classList.remove('hidden');
  document.getElementById('scenario-total').textContent = scenarioQuestions.length;
  
  displayScenarioQuestion();
  saveScenarioSession();
}

function displayScenarioQuestion() {
  const s = scenarioQuestions[scenarioIndex];
  document.getElementById('scenario-topic').textContent = s.topic;
  document.getElementById('scenario-difficulty').textContent = s.difficulty;
  document.getElementById('scenario-difficulty').className = 'difficulty-badge difficulty-' + s.difficulty;
  document.getElementById('scenario-text').textContent = s.scenario;
  document.getElementById('scenario-question').textContent = s.question;
  document.getElementById('scenario-index').textContent = scenarioIndex + 1;
  document.getElementById('scenario-progress-bar').style.width = ((scenarioIndex + 1) / scenarioQuestions.length) * 100 + '%';
  
  const optionsContainer = document.getElementById('scenario-options');
  optionsContainer.innerHTML = '';
  
  const isAnswered = scenarioAnswers[scenarioIndex] !== null;
  
  s.options.forEach((opt, i) => {
    const item = document.createElement('div');
    item.className = 'option-item';
    if (isAnswered) {
      item.classList.add('disabled');
      if (i === s.correctIndex) item.classList.add('correct');
      else if (i === scenarioAnswers[scenarioIndex]) item.classList.add('incorrect');
    } else if (selectedScenarioAnswer === i) {
      item.classList.add('selected');
    }
    item.innerHTML = `<div class="option-radio"></div><span class="option-text">${opt}</span>`;
    if (!isAnswered) item.onclick = () => selectScenarioOption(i);
    optionsContainer.appendChild(item);
  });
  
  if (isAnswered) {
    const explanation = document.createElement('div');
    explanation.className = 'explanation';
    explanation.innerHTML = `<div class="explanation-title">Explanation</div><div class="explanation-text">${s.explanation}</div>`;
    optionsContainer.appendChild(explanation);
  }
  
  document.getElementById('scenario-submit-btn').classList.toggle('hidden', isAnswered);
  document.getElementById('scenario-submit-btn').disabled = selectedScenarioAnswer === null && !isAnswered;
  document.getElementById('next-scenario-btn').classList.toggle('hidden', !isAnswered);
  document.getElementById('next-scenario-btn').textContent = scenarioIndex === scenarioQuestions.length - 1 && isAnswered ? 'See Results ‚Üí' : 'Next Scenario ‚Üí';
}

function selectScenarioOption(index) {
  if (scenarioAnswers[scenarioIndex] !== null) return;
  selectedScenarioAnswer = index;
  displayScenarioQuestion();
  saveScenarioSession();
}

function submitScenarioAnswer() {
  if (selectedScenarioAnswer === null) return;
  scenarioAnswers[scenarioIndex] = selectedScenarioAnswer;
  displayScenarioQuestion();
  saveScenarioSession();
}

function nextScenario() {
  if (scenarioIndex < scenarioQuestions.length - 1) {
    scenarioIndex++;
    selectedScenarioAnswer = scenarioAnswers[scenarioIndex];
    displayScenarioQuestion();
    saveScenarioSession();
  } else {
    finishScenarios();
  }
}

function finishScenarios() {
  scenarioFinished = true;
  
  const correct = scenarioAnswers.filter((a, i) => a === scenarioQuestions[i].correctIndex).length;
  const total = scenarioQuestions.length;
  const score = Math.round((correct / total) * 100);
  const passed = score >= 80;
  
  document.getElementById('scenario-card').classList.add('hidden');
  document.getElementById('scenario-question-card').classList.add('hidden');
  document.getElementById('scenario-actions').classList.add('hidden');
  document.getElementById('scenario-results').classList.remove('hidden');
  
  document.getElementById('scenario-results-icon').textContent = passed ? 'üéâ' : 'üìö';
  document.getElementById('scenario-results-title').textContent = passed ? 'Great Job!' : 'Keep Practicing!';
  document.getElementById('scenario-results-title').style.color = passed ? '#7c3aed' : '#dc2626';
  document.getElementById('scenario-results-score').textContent = score + '%';
  document.getElementById('scenario-results-score').style.color = passed ? '#7c3aed' : '#dc2626';
  document.getElementById('scenario-correct-count').textContent = correct;
  document.getElementById('scenario-incorrect-count').textContent = total - correct;
  
  progress.scenarioTest.testsTaken++;
  progress.scenarioTest.averageScore = Math.round((progress.scenarioTest.averageScore * (progress.scenarioTest.testsTaken - 1) + score) / progress.scenarioTest.testsTaken);
  if (score > progress.scenarioTest.highScore) progress.scenarioTest.highScore = score;
  if (passed) progress.scenarioTest.passedTests++;
  saveProgress();
  
  session.scenarioTest = null;
  saveSession();
}

function saveScenarioSession() {
  session.scenarioTest = {
    active: !scenarioFinished,
    index: scenarioIndex,
    answers: scenarioAnswers,
    selectedAnswer: selectedScenarioAnswer
  };
  saveSession();
}

// ==================== ANALYTICS ====================
function updateAnalytics() {
  document.getElementById('stat-flashcards-seen').textContent = progress.permitFlashcards.seen.length;
  document.getElementById('stat-flashcards-known').textContent = progress.permitFlashcards.known.length;
  document.getElementById('stat-avg-score').textContent = progress.permitTest.averageScore > 0 ? progress.permitTest.averageScore + '%' : '-';
  document.getElementById('stat-tests-passed').textContent = progress.permitTest.passedTests + progress.scenarioTest.passedTests;
}

function resetAllProgress() {
  if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
    localStorage.removeItem('driveyourtest_progress');
    localStorage.removeItem('driveyourtest_session');
    location.reload();
  }
}
  </script>
</body>
</html>
