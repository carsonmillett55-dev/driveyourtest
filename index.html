<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drive Your Test - Driver's Education & Permit Practice</title>
  <meta name="description" content="Master your permit test and driving exam with interactive flashcards and practice tests.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6924346257512616" crossorigin="anonymous"></script>
  
  <style>
    :root {
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --radius: 1rem;
      --radius-sm: 0.5rem;
      --radius-lg: 1.5rem;
      --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Light Mode */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.1);
      --shadow-xl: 0 25px 50px -12px rgba(0,0,0,0.15);
      --glass-bg: rgba(255,255,255,0.8);
      --glass-border: rgba(255,255,255,0.5);
      
      /* Accent Colors */
      --emerald-500: #10b981;
      --emerald-600: #059669;
      --blue-500: #3b82f6;
      --blue-600: #2563eb;
      --purple-500: #8b5cf6;
      --purple-600: #7c3aed;
      --amber-500: #f59e0b;
      --red-500: #ef4444;
    }
    
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      --border-color: #334155;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.4);
      --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.5);
      --shadow-xl: 0 25px 50px -12px rgba(0,0,0,0.6);
      --glass-bg: rgba(30,41,59,0.8);
      --glass-border: rgba(51,65,85,0.5);
    }
    
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { scroll-behavior: smooth; }
    
    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      transition: background var(--transition), color var(--transition);
      overflow-x: hidden;
    }
    
    /* Animated Background */
    .bg-gradient {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: -1;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
      animation: gradientMove 20s ease-in-out infinite;
    }
    
    [data-theme="dark"] .bg-gradient {
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
    }
    
    @keyframes gradientMove {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.1) rotate(5deg); }
    }
    
    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      transition: all var(--transition);
    }
    
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: none;
      border: none;
      cursor: pointer;
      transition: transform var(--transition);
    }
    
    .logo:hover { transform: scale(1.02); }
    
    .logo-icon {
      font-size: 2rem;
      animation: carBounce 2s ease-in-out infinite;
    }
    
    @keyframes carBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }
    
    .logo-text {
      font-size: 1.375rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--emerald-500), var(--blue-500), var(--purple-500));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .theme-toggle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      transition: all var(--transition);
    }
    
    .theme-toggle:hover {
      background: var(--bg-secondary);
      transform: rotate(15deg);
      box-shadow: var(--shadow-lg);
    }
    
    /* Main Content */
    .main { padding-bottom: 3rem; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
    
    .page-layout {
      display: flex;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }
    
    .main-content { flex: 1; min-width: 0; }
    
    .sidebar {
      width: 180px;
      flex-shrink: 0;
      display: none;
    }
    
    @media (min-width: 1100px) {
      .sidebar { display: block; }
    }
    
    /* View Container */
    .view-container { display: none; animation: fadeIn 0.4s ease-out; }
    .view-container.active { display: block; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Hero Section */
    .hero {
      text-align: center;
      padding: 3rem 0 2rem;
    }
    
    .hero-title {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      letter-spacing: -1px;
      margin-bottom: 0.75rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero-subtitle {
      color: var(--text-secondary);
      font-size: 1.125rem;
      max-width: 500px;
      margin: 0 auto;
    }
    
    /* Stats Bar */
    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
      margin: 2rem 0;
      padding: 1.5rem;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-color);
    }
    
    .stat-item {
      text-align: center;
      min-width: 80px;
    }
    
    .stat-value {
      font-size: 1.75rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--emerald-500), var(--blue-500));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    /* Cards */
    .card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow);
      transition: all var(--transition);
      overflow: hidden;
    }
    
    .card:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .card-header { padding: 1.5rem 1.5rem 0; }
    .card-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card-content { padding: 1.25rem 1.5rem 1.5rem; }
    .card-footer { padding: 1.25rem 1.5rem; border-top: 1px solid var(--border-color); background: var(--bg-tertiary); }
    
    /* Mode Cards */
    .modes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .mode-card {
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .mode-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--emerald-500), var(--blue-500), var(--purple-500));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform var(--transition);
    }
    
    .mode-card:hover::before { transform: scaleX(1); }
    
    .mode-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }
    
    .mode-card-emerald::before { background: linear-gradient(90deg, #10b981, #34d399); }
    .mode-card-blue::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
    .mode-card-purple::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
    
    .mode-icon {
      font-size: 3rem;
      margin-bottom: 0.75rem;
      display: block;
      transition: transform var(--transition);
    }
    
    .mode-card:hover .mode-icon { transform: scale(1.1) rotate(-5deg); }
    
    .mode-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    
    .title-emerald { color: var(--emerald-600); }
    .title-blue { color: var(--blue-600); }
    .title-purple { color: var(--purple-600); }
    
    .mode-desc { font-size: 0.875rem; color: var(--text-secondary); }
    
    /* Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge-emerald { background: rgba(16, 185, 129, 0.15); color: var(--emerald-500); }
    .badge-blue { background: rgba(59, 130, 246, 0.15); color: var(--blue-500); }
    .badge-purple { background: rgba(139, 92, 246, 0.15); color: var(--purple-500); }
    .badge-amber { background: rgba(245, 158, 11, 0.15); color: var(--amber-500); }
    
    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--bg-tertiary);
      border-radius: 9999px;
      overflow: hidden;
      margin: 1rem 0;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 9999px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .progress-emerald { background: linear-gradient(90deg, #10b981, #34d399); }
    .progress-blue { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
    .progress-purple { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
    
    /* Tags */
    .tags { display: flex; flex-wrap: wrap; gap: 0.375rem; }
    .tag {
      padding: 0.25rem 0.625rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      font-size: 0.6875rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      border-radius: var(--radius);
      border: none;
      cursor: pointer;
      transition: all var(--transition);
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:active::before { width: 300px; height: 300px; }
    
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .btn-emerald {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
    }
    .btn-emerald:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5); }
    
    .btn-blue {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
    }
    .btn-blue:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
    
    .btn-purple {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      box-shadow: 0 4px 14px rgba(139, 92, 246, 0.4);
    }
    .btn-purple:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5); }
    
    .btn-outline {
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
    }
    .btn-outline:hover:not(:disabled) { background: var(--bg-tertiary); border-color: var(--text-muted); }
    
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.8125rem; width: auto; }
    
    /* Back Header */
    .back-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }
    
    .back-btn {
      padding: 0.625rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all var(--transition);
    }
    
    .back-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); transform: translateX(-4px); }
    
    .view-title { font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px; }
    
    /* Flashcards */
    .category-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }
    
    .category-btn {
      padding: 0.5rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 9999px;
      cursor: pointer;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all var(--transition);
    }
    
    .category-btn:hover { background: var(--bg-tertiary); }
    .category-btn.active { background: var(--emerald-500); color: white; border-color: var(--emerald-500); }
    
    .flashcard-container { perspective: 1200px; margin-bottom: 1.5rem; }
    
    .flashcard {
      width: 100%;
      height: 320px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    
    .flashcard.flipped { transform: rotateY(180deg); }
    
    .flashcard-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2.5rem;
      text-align: center;
      box-shadow: var(--shadow-xl);
    }
    
    .flashcard-front {
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      border: 2px solid #86efac;
    }
    
    [data-theme="dark"] .flashcard-front {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.1));
      border-color: rgba(16, 185, 129, 0.3);
    }
    
    .flashcard-back {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border: 2px solid #4ade80;
      transform: rotateY(180deg);
    }
    
    [data-theme="dark"] .flashcard-back {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(74, 222, 128, 0.1));
      border-color: rgba(74, 222, 128, 0.3);
    }
    
    .flashcard-category {
      font-size: 0.6875rem;
      color: var(--emerald-600);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1rem;
      padding: 0.375rem 0.75rem;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 9999px;
    }
    
    .flashcard-text { font-size: 1.125rem; font-weight: 500; line-height: 1.7; max-width: 90%; }
    .flashcard-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: 1.5rem; opacity: 0.7; }
    
    .card-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .nav-btn {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
      color: var(--text-primary);
    }
    
    .nav-btn:hover:not(:disabled) { background: var(--bg-tertiary); transform: scale(1.1); }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    
    .card-counter { font-size: 0.875rem; color: var(--text-secondary); font-weight: 500; min-width: 80px; text-align: center; }
    
    .rating-buttons { display: flex; gap: 1rem; justify-content: center; }
    
    .rating-btn {
      padding: 0.875rem 1.75rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all var(--transition);
      border: 2px solid;
    }
    
    .rating-know {
      background: rgba(16, 185, 129, 0.1);
      color: var(--emerald-600);
      border-color: var(--emerald-500);
    }
    .rating-know:hover { background: var(--emerald-500); color: white; transform: translateY(-2px); }
    
    .rating-practice {
      background: rgba(245, 158, 11, 0.1);
      color: var(--amber-500);
      border-color: var(--amber-500);
    }
    .rating-practice:hover { background: var(--amber-500); color: white; transform: translateY(-2px); }
    
    /* Test Styles */
    .test-progress { margin-bottom: 1.5rem; }
    
    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .test-timer {
      font-size: 1.5rem;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      color: var(--blue-500);
    }
    
    .test-timer.warning { color: var(--amber-500); animation: pulse 1s infinite; }
    .test-timer.danger { color: var(--red-500); animation: pulse 0.5s infinite; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .question-counter { font-size: 0.875rem; color: var(--text-secondary); font-weight: 500; }
    
    .question-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow);
    }
    
    .question-category {
      font-size: 0.6875rem;
      color: var(--blue-500);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1rem;
      display: inline-block;
      background: rgba(59, 130, 246, 0.1);
      padding: 0.375rem 0.75rem;
      border-radius: 9999px;
    }
    
    .question-text {
      font-size: 1.125rem;
      font-weight: 600;
      line-height: 1.7;
      margin-bottom: 1.5rem;
    }
    
    .options-list { display: flex; flex-direction: column; gap: 0.75rem; }
    
    .option-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--transition);
    }
    
    .option-item:hover:not(.disabled) { border-color: var(--blue-500); background: rgba(59, 130, 246, 0.05); transform: translateX(4px); }
    .option-item.selected { border-color: var(--blue-500); background: rgba(59, 130, 246, 0.1); }
    .option-item.correct { border-color: var(--emerald-500); background: rgba(16, 185, 129, 0.1); }
    .option-item.incorrect { border-color: var(--red-500); background: rgba(239, 68, 68, 0.1); }
    .option-item.disabled { cursor: default; }
    
    .option-radio {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid var(--border-color);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
    }
    
    .option-item.selected .option-radio { border-color: var(--blue-500); background: var(--blue-500); }
    .option-item.selected .option-radio::after { content: '‚úì'; color: white; font-size: 0.75rem; font-weight: bold; }
    .option-item.correct .option-radio { border-color: var(--emerald-500); background: var(--emerald-500); }
    .option-item.correct .option-radio::after { content: '‚úì'; color: white; font-size: 0.75rem; font-weight: bold; }
    .option-item.incorrect .option-radio { border-color: var(--red-500); background: var(--red-500); }
    .option-item.incorrect .option-radio::after { content: '‚úó'; color: white; font-size: 0.75rem; font-weight: bold; }
    
    .option-text { font-size: 0.9375rem; font-weight: 500; }
    
    .test-actions { display: flex; gap: 1rem; margin-top: 1rem; }
    .hidden { display: none !important; }
    
    /* Explanation */
    .explanation {
      margin-top: 1.5rem;
      padding: 1.25rem;
      background: rgba(16, 185, 129, 0.08);
      border-radius: var(--radius);
      border-left: 4px solid var(--emerald-500);
    }
    
    [data-theme="dark"] .explanation { background: rgba(16, 185, 129, 0.1); }
    
    .explanation-title { font-weight: 700; color: var(--emerald-600); margin-bottom: 0.5rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .explanation-text { color: var(--text-secondary); font-size: 0.9375rem; line-height: 1.7; }
    
    /* Results */
    .results-card {
      text-align: center;
      padding: 3rem 2rem;
      animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .results-icon { font-size: 5rem; margin-bottom: 1rem; animation: bounce 1s ease infinite; }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .results-title { font-size: 1.75rem; font-weight: 800; margin-bottom: 0.5rem; }
    .results-score { font-size: 4rem; font-weight: 800; margin-bottom: 1.5rem; letter-spacing: -2px; }
    
    .results-stats { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; }
    .results-stat { text-align: center; }
    .results-stat-value { font-size: 2rem; font-weight: 800; }
    .results-stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    
    .results-actions { display: flex; gap: 1rem; justify-content: center; }
    
    /* Scenario Card */
    .scenario-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(167, 139, 250, 0.05));
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1rem;
      position: relative;
    }
    
    .scenario-topic {
      font-size: 0.6875rem;
      color: var(--purple-600);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .scenario-text { font-size: 1rem; line-height: 1.7; margin-top: 0.75rem; color: var(--text-primary); }
    
    .difficulty-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.625rem;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .difficulty-easy { background: rgba(16, 185, 129, 0.15); color: var(--emerald-500); }
    .difficulty-medium { background: rgba(245, 158, 11, 0.15); color: var(--amber-500); }
    .difficulty-hard { background: rgba(239, 68, 68, 0.15); color: var(--red-500); }
    
    /* Resume Banner */
    .resume-banner {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      animation: slideDown 0.5s ease-out;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .resume-text { font-size: 0.875rem; font-weight: 500; }
    
    /* Footer */
    .site-footer {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      padding: 2rem 1.5rem;
      margin-top: 3rem;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      text-align: center;
    }
    
    .footer-brand { display: flex; align-items: center; gap: 0.5rem; }
    .footer-logo { font-size: 1.5rem; }
    .footer-name { font-size: 1.125rem; font-weight: 700; }
    
    .footer-nav { display: flex; gap: 2rem; flex-wrap: wrap; }
    .footer-nav a { color: var(--text-secondary); text-decoration: none; font-size: 0.875rem; cursor: pointer; transition: color var(--transition); }
    .footer-nav a:hover { color: var(--text-primary); }
    
    .footer-copy { font-size: 0.75rem; color: var(--text-muted); }
    
    @media (min-width: 768px) {
      .footer-content { flex-direction: row; justify-content: space-between; text-align: left; }
    }
    
    /* Privacy & Contact Pages */
    .page-content { max-width: 800px; margin: 0 auto; padding: 2rem 1.5rem; }
    .page-title { font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; letter-spacing: -0.5px; }
    .page-subtitle { color: var(--text-secondary); margin-bottom: 2rem; }
    .section-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color); }
    .content-section { margin-bottom: 2rem; }
    .content-section p, .content-section li { color: var(--text-secondary); margin-bottom: 0.75rem; line-height: 1.8; }
    .content-section ul { padding-left: 1.5rem; }
    
    .highlight-box {
      background: rgba(59, 130, 246, 0.08);
      border-left: 4px solid var(--blue-500);
      padding: 1rem 1.25rem;
      margin: 1rem 0;
      border-radius: 0 var(--radius) var(--radius) 0;
    }
    
    [data-theme="dark"] .highlight-box { background: rgba(59, 130, 246, 0.1); }
    .highlight-box p { color: var(--blue-500); margin: 0; }
    
    /* Form Styles */
    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.875rem; }
    
    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius);
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all var(--transition);
      font-family: inherit;
    }
    
    .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--blue-500); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .form-textarea { min-height: 150px; resize: vertical; }
    .form-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; }
    
    .submit-btn {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--transition);
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
    }
    
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
    
    /* Info Cards */
    .info-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }
    
    .info-card {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 1.5rem;
      text-align: center;
      border: 1px solid var(--border-color);
      transition: all var(--transition);
    }
    
    .info-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .info-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .info-title { font-weight: 700; margin-bottom: 0.25rem; }
    .info-text { font-size: 0.875rem; color: var(--text-muted); }
    
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      overflow: hidden;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confettiFall 3s linear forwards;
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .toast {
      padding: 1rem 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow-xl);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideInRight 0.3s ease-out;
      max-width: 350px;
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .toast-icon { font-size: 1.25rem; }
    .toast-message { font-size: 0.875rem; font-weight: 500; }
    
    /* Streak Badge */
    .streak-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.1));
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--amber-500);
    }
    
    /* Loading Animation */
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--blue-500);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Achievement Popup */
    .achievement-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-secondary);
      border: 2px solid var(--emerald-500);
      border-radius: var(--radius-lg);
      padding: 2rem;
      text-align: center;
      z-index: 1001;
      box-shadow: var(--shadow-xl);
      animation: popIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    .achievement-icon { font-size: 4rem; margin-bottom: 1rem; }
    .achievement-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--emerald-500); }
    .achievement-desc { color: var(--text-secondary); margin-bottom: 1rem; }
    
    /* Responsive */
    @media (max-width: 640px) {
      .hero-title { font-size: 1.75rem; }
      .stats-bar { gap: 1rem; padding: 1rem; }
      .stat-value { font-size: 1.5rem; }
      .modes-grid { grid-template-columns: 1fr; }
      .results-score { font-size: 3rem; }
      .test-actions { flex-direction: column; }
      .rating-buttons { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  
  <header class="header">
    <div class="header-content">
      <button class="logo" onclick="goHome()">
        <span class="logo-icon">üöó</span>
        <span class="logo-text">driveyourtest.com</span>
      </button>
      <div class="header-actions">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
          <span id="theme-icon">üåô</span>
        </button>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- HOME VIEW -->
    <div id="home-view" class="view-container active">
      <div class="container">
        <!-- Ad: Top of Content -->
        <ins class="adsbygoogle" style="display:block; margin: 1rem 0;" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_1" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

        <div class="hero">
          <h1 class="hero-title">Drive Your Test Results</h1>
          <p class="hero-subtitle">Master your permit test and driving exam with interactive flashcards and practice tests.</p>
        </div>

        <div class="stats-bar">
          <div class="stat-item">
            <div class="stat-value" id="flashcard-progress">0%</div>
            <div class="stat-label">Flashcards</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="permit-tests">0</div>
            <div class="stat-label">Tests Taken</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="best-score">-</div>
            <div class="stat-label">Best Score</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="streak-count">0</div>
            <div class="stat-label">Day Streak üî•</div>
          </div>
        </div>

        <div id="resume-banner" class="resume-banner hidden">
          <span class="resume-text">üìã You have a session in progress</span>
          <div>
            <button class="btn btn-sm btn-outline" onclick="clearSessionAndRefresh()">Start Fresh</button>
          </div>
        </div>

        <!-- Ad: Mid Content -->
        <ins class="adsbygoogle" style="display:block; margin: 1.5rem 0;" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_2" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

        <div class="modes-grid">
          <!-- Flashcards -->
          <div class="card mode-card mode-card-emerald" onclick="startFlashcards()">
            <div class="card-header">
              <span class="mode-icon">üìö</span>
              <div class="mode-title title-emerald">Permit Flash Cards</div>
              <div class="mode-desc">100 flashcards covering all test topics</div>
            </div>
            <div class="card-content">
              <div class="progress-bar">
                <div class="progress-fill progress-emerald" id="flashcard-bar" style="width: 0%"></div>
              </div>
              <div class="tags">
                <span class="tag">Road Signs</span>
                <span class="tag">Traffic Laws</span>
                <span class="tag">Right-of-Way</span>
                <span class="tag">Safe Driving</span>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-emerald">Start Learning</button>
            </div>
          </div>

          <!-- Permit Test -->
          <div class="card mode-card mode-card-blue" onclick="startPermitTest()">
            <div class="card-header">
              <span class="mode-icon">üìù</span>
              <div class="mode-title title-blue">Permit Practice Test</div>
              <div class="mode-desc">40 questions ‚Ä¢ 45 minutes ‚Ä¢ Timed</div>
            </div>
            <div class="card-content">
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <span class="badge badge-blue">Timed</span>
                <span class="badge badge-amber">Instant Feedback</span>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-blue">Take Test</button>
            </div>
          </div>

          <!-- Driving Scenarios -->
          <div class="card mode-card mode-card-purple" onclick="startScenarios()">
            <div class="card-header">
              <span class="mode-icon">üöô</span>
              <div class="mode-title title-purple">Driving Scenarios</div>
              <div class="mode-desc">20 real-world scenarios ‚Ä¢ No time limit</div>
            </div>
            <div class="card-content">
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <span class="badge badge-purple">No Timer</span>
                <span class="badge badge-amber">Explanations</span>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-purple">Start Test</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar Ad -->
      <aside class="sidebar" style="position: fixed; right: 2rem; top: 100px;">
        <ins class="adsbygoogle" style="display:block; width: 160px; height: 600px;" data-ad-client="ca-pub-6924346257512616" data-ad-slot="YOUR_AD_SLOT_3" data-ad-format="vertical"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </aside>
    </div>

    <!-- FLASHCARDS VIEW -->
    <div id="flashcards-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back</button>
          <h2 class="view-title">Permit Flash Cards</h2>
        </div>

        <div class="category-selector">
          <button class="category-btn active" data-category="all" onclick="selectCategory('all')">All (100)</button>
          <button class="category-btn" data-category="Road Signs" onclick="selectCategory('Road Signs')">Road Signs (25)</button>
          <button class="category-btn" data-category="Traffic Laws" onclick="selectCategory('Traffic Laws')">Traffic Laws (30)</button>
          <button class="category-btn" data-category="Right-of-Way" onclick="selectCategory('Right-of-Way')">Right-of-Way (20)</button>
          <button class="category-btn" data-category="Safe Driving" onclick="selectCategory('Safe Driving')">Safe Driving (25)</button>
        </div>

        <div class="flashcard-container">
          <div class="flashcard" id="flashcard" onclick="flipCard()">
            <div class="flashcard-face flashcard-front">
              <div class="flashcard-category" id="card-category">Category</div>
              <div class="flashcard-text" id="card-front">Question</div>
              <div class="flashcard-hint">Click to flip</div>
            </div>
            <div class="flashcard-face flashcard-back">
              <div class="flashcard-text" id="card-back">Answer</div>
              <div class="flashcard-hint">Click to flip back</div>
            </div>
          </div>
        </div>

        <div class="card-nav">
          <button class="nav-btn" id="prev-btn" onclick="prevCard()">‚Üê</button>
          <span class="card-counter"><span id="card-index">1</span> / <span id="card-total">100</span></span>
          <button class="nav-btn" id="next-btn" onclick="nextCard()">‚Üí</button>
        </div>

        <div class="rating-buttons" id="rating-buttons">
          <button class="rating-btn rating-know" onclick="rateCard('known')">‚úì I Know This</button>
          <button class="rating-btn rating-practice" onclick="rateCard('practice')">‚Üí Needs Practice</button>
        </div>
      </div>
    </div>

    <!-- PERMIT TEST VIEW -->
    <div id="permit-test-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="confirmExit()">‚Üê Exit Test</button>
          <h2 class="view-title">Permit Practice Test</h2>
        </div>

        <div class="test-progress">
          <div class="test-header">
            <span class="test-timer" id="test-timer">45:00</span>
            <span class="question-counter">Question <span id="test-index">1</span> of <span id="test-total">40</span></span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill progress-blue" id="test-progress-bar" style="width: 0%"></div>
          </div>
        </div>

        <div class="question-card" id="test-question-card">
          <span class="question-category" id="test-category">Category</span>
          <div class="question-text" id="test-question">Question text</div>
          <div class="options-list" id="test-options"></div>
        </div>

        <div class="test-actions" id="test-actions">
          <button class="btn btn-outline" id="submit-btn" onclick="submitTestAnswer()" disabled>Submit Answer</button>
          <button class="btn btn-blue hidden" id="next-question-btn" onclick="nextTestQuestion()">Next Question ‚Üí</button>
        </div>

        <div class="results-card card hidden" id="test-results">
          <div class="results-icon" id="results-icon">üéâ</div>
          <div class="results-title" id="results-title">Test Complete!</div>
          <div class="results-score" id="results-score">85%</div>
          <div class="results-stats">
            <div class="results-stat">
              <div class="results-stat-value" id="correct-count">34</div>
              <div class="results-stat-label">Correct</div>
            </div>
            <div class="results-stat">
              <div class="results-stat-value" id="incorrect-count">6</div>
              <div class="results-stat-label">Incorrect</div>
            </div>
          </div>
          <div class="results-actions">
            <button class="btn btn-outline" onclick="goHome()">Back to Home</button>
            <button class="btn btn-blue" onclick="startPermitTest()">Retake Test</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SCENARIOS VIEW -->
    <div id="scenarios-view" class="view-container">
      <div class="container">
        <div class="back-header">
          <button class="back-btn" onclick="confirmExit()">‚Üê Exit Test</button>
          <h2 class="view-title">Driving Scenarios</h2>
        </div>

        <div class="test-progress">
          <div class="test-header">
            <span class="test-timer" style="color: var(--purple-500);">No Time Limit</span>
            <span class="question-counter">Scenario <span id="scenario-index">1</span> of <span id="scenario-total">20</span></span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill progress-purple" id="scenario-progress-bar" style="width: 0%"></div>
          </div>
        </div>

        <div class="scenario-card" id="scenario-card">
          <span class="scenario-topic" id="scenario-topic">Topic</span>
          <span class="difficulty-badge difficulty-medium" id="scenario-difficulty">Medium</span>
          <div class="scenario-text" id="scenario-text">Scenario description</div>
        </div>

        <div class="question-card" id="scenario-question-card">
          <div class="question-text" id="scenario-question">Question text</div>
          <div class="options-list" id="scenario-options"></div>
        </div>

        <div class="test-actions" id="scenario-actions">
          <button class="btn btn-outline" id="scenario-submit-btn" onclick="submitScenarioAnswer()" disabled>Submit Answer</button>
          <button class="btn btn-purple hidden" id="next-scenario-btn" onclick="nextScenario()">Next Scenario ‚Üí</button>
        </div>

        <div class="results-card card hidden" id="scenario-results">
          <div class="results-icon" id="scenario-results-icon">üéâ</div>
          <div class="results-title" id="scenario-results-title">Scenarios Complete!</div>
          <div class="results-score" id="scenario-results-score">85%</div>
          <div class="results-stats">
            <div class="results-stat">
              <div class="results-stat-value" id="scenario-correct-count">17</div>
              <div class="results-stat-label">Correct</div>
            </div>
            <div class="results-stat">
              <div class="results-stat-value" id="scenario-incorrect-count">3</div>
              <div class="results-stat-label">Incorrect</div>
            </div>
          </div>
          <div class="results-actions">
            <button class="btn btn-outline" onclick="goHome()">Back to Home</button>
            <button class="btn btn-purple" onclick="startScenarios()">Retake Test</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PRIVACY VIEW -->
    <div id="privacy-view" class="view-container">
      <div class="page-content">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
        </div>

        <div class="card" style="padding: 2rem;">
          <h1 class="page-title">Privacy Policy</h1>
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 2rem;">Last updated: February 21, 2025</p>

          <div class="content-section">
            <h2 class="section-title">Introduction</h2>
            <p>Welcome to Drive Your Test. We are committed to protecting your personal information and your right to privacy. This Privacy Policy explains how we collect, use, and safeguard your information.</p>
          </div>

          <div class="content-section">
            <h2 class="section-title">Information We Collect</h2>
            <ul>
              <li><strong>Contact Information:</strong> When you use our contact form, we collect your name, email address, and message content.</li>
              <li><strong>Learning Progress:</strong> We store your quiz scores and progress locally on your device.</li>
              <li><strong>Usage Data:</strong> Pages visited and features used for improving our service.</li>
            </ul>
          </div>

          <div class="content-section">
            <h2 class="section-title">Google AdSense</h2>
            <div class="highlight-box">
              <p>We use Google AdSense to display advertisements. Google may use cookies to serve ads based on your prior visits. You can opt out at <a href="https://www.google.com/settings/ads" target="_blank" style="color: var(--blue-500);">Google Ads Settings</a>.</p>
            </div>
          </div>

          <div class="content-section">
            <h2 class="section-title">Contact Us</h2>
            <p>Questions? Email us at <a href="mailto:driveyourtest@gmail.com" style="color: var(--blue-500);">driveyourtest@gmail.com</a></p>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTACT VIEW -->
    <div id="contact-view" class="view-container">
      <div class="page-content">
        <div class="back-header">
          <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
        </div>

        <h1 class="page-title" style="text-align: center;">Contact Us</h1>
        <p class="page-subtitle" style="text-align: center;">Have a question or feedback? We'd love to hear from you!</p>

        <div class="card" style="padding: 2rem;">
          <form action="https://formsubmit.co/driveyourtest@gmail.com" method="POST">
            <input type="hidden" name="_subject" value="New Contact Form - Drive Your Test">
            <input type="hidden" name="_captcha" value="true">
            <input type="hidden" name="_template" value="table">

            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <input type="text" name="name" class="form-input" placeholder="John Doe" required>
            </div>

            <div class="form-group">
              <label class="form-label">Email Address *</label>
              <input type="email" name="email" class="form-input" placeholder="john@example.com" required>
              <p class="form-hint">We'll never share your email.</p>
            </div>

            <div class="form-group">
              <label class="form-label">Subject *</label>
              <select name="subject" class="form-select" required>
                <option value="">Select a topic...</option>
                <option value="General Question">General Question</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Bug Report">Bug Report</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Message *</label>
              <textarea name="message" class="form-textarea" placeholder="How can we help you?" required></textarea>
            </div>

            <button type="submit" class="submit-btn">Send Message</button>
          </form>
        </div>

        <div class="info-cards">
          <div class="info-card">
            <div class="info-icon">üìß</div>
            <div class="info-title">Email Us</div>
            <p class="info-text">driveyourtest@gmail.com</p>
          </div>
          <div class="info-card">
            <div class="info-icon">‚è∞</div>
            <div class="info-title">Response Time</div>
            <p class="info-text">Within 24-48 hours</p>
          </div>
          <div class="info-card">
            <div class="info-icon">üîí</div>
            <div class="info-title">Your Privacy</div>
            <p class="info-text">Your data is secure</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <span class="footer-logo">üöó</span>
        <span class="footer-name">Drive Your Test</span>
      </div>
      <nav class="footer-nav">
        <a onclick="goHome()">Home</a>
        <a onclick="showView('privacy')">Privacy Policy</a>
        <a onclick="showView('contact')">Contact Us</a>
      </nav>
      <p class="footer-copy">¬© 2025 Drive Your Test. All rights reserved.</p>
    </div>
  </footer>

  <div class="toast-container" id="toast-container"></div>
  <div class="confetti-container" id="confetti-container"></div>

<script>
// ==================== FLASHCARD DATA ====================
const permitFlashcards = [
  { id: 'pf1', category: 'Road Signs', front: 'üõë What does a red octagonal sign mean?', back: 'STOP - You must come to a complete stop, then proceed when safe.' },
  { id: 'pf2', category: 'Road Signs', front: '‚ö†Ô∏è What does a yellow diamond-shaped sign indicate?', back: 'Warning sign - alerts drivers to potential hazards ahead.' },
  { id: 'pf3', category: 'Road Signs', front: 'üö∏ What does a pentagon-shaped sign indicate?', back: 'School zone or school crossing - watch for children.' },
  { id: 'pf4', category: 'Road Signs', front: 'What does a circular sign mean?', back: 'Railroad crossing ahead - be prepared to stop.' },
  { id: 'pf5', category: 'Road Signs', front: 'üÖøÔ∏è What does a blue sign with "P" mean?', back: 'Parking is permitted in this area.' },
  { id: 'pf6', category: 'Road Signs', front: '‚õî What does a red circle with a white horizontal bar mean?', back: 'DO NOT ENTER - road closed to traffic in your direction.' },
  { id: 'pf7', category: 'Road Signs', front: 'What does an orange diamond-shaped sign indicate?', back: 'Construction or maintenance zone ahead.' },
  { id: 'pf8', category: 'Road Signs', front: 'What does a red X above a lane mean?', back: 'Lane is closed - do not drive in this lane.' },
  { id: 'pf9', category: 'Road Signs', front: 'What does a green arrow above a lane mean?', back: 'Lane is open for travel.' },
  { id: 'pf10', category: 'Road Signs', front: 'What does a brown sign indicate?', back: 'Recreational or cultural interest - parks, historical sites.' },
  { id: 'pf11', category: 'Road Signs', front: 'What does a blue sign indicate?', back: 'Service information - gas, food, lodging, hospitals.' },
  { id: 'pf12', category: 'Road Signs', front: 'What does a green sign indicate?', back: 'Guide sign - directions, distances, destinations.' },
  { id: 'pf13', category: 'Road Signs', front: 'What does a red circle with slash mean?', back: 'The action shown is prohibited.' },
  { id: 'pf14', category: 'Road Signs', front: 'What does a flashing yellow light mean?', back: 'Slow down and proceed with caution.' },
  { id: 'pf15', category: 'Road Signs', front: 'What does a flashing red light mean?', back: 'Stop completely, then proceed when safe (like a stop sign).' },
  { id: 'pf16', category: 'Road Signs', front: 'ü¶å What does a deer crossing sign mean?', back: 'Watch for deer, especially at dawn and dusk.' },
  { id: 'pf17', category: 'Road Signs', front: 'What does a winding road sign look like?', back: 'Yellow diamond with a wavy line - curves ahead.' },
  { id: 'pf18', category: 'Road Signs', front: 'What does a slippery when wet sign mean?', back: 'Road surface is slippery when wet - reduce speed.' },
  { id: 'pf19', category: 'Road Signs', front: 'What does a merge sign indicate?', back: 'Traffic merging from the right - prepare to yield.' },
  { id: 'pf20', category: 'Road Signs', front: 'What does a yield sign look like?', back: 'Red and white triangle pointing down - yield to traffic.' },
  { id: 'pf21', category: 'Traffic Laws', front: 'What is the legal BAC limit for drivers 21+?', back: '0.08% in most states. Lower for commercial drivers.' },
  { id: 'pf22', category: 'Traffic Laws', front: 'What is the speed limit in a school zone?', back: 'Usually 15-25 mph when children are present.' },
  { id: 'pf23', category: 'Traffic Laws', front: 'When must you use your turn signal?', back: 'At least 100 feet before turning or changing lanes.' },
  { id: 'pf24', category: 'Traffic Laws', front: 'What is the "Move Over" law?', back: 'Move over or slow down for emergency vehicles with flashing lights.' },
  { id: 'pf25', category: 'Traffic Laws', front: 'How far must you stop from a school bus?', back: 'At least 20 feet on undivided roads, both directions.' },
  { id: 'pf26', category: 'Traffic Laws', front: 'When are headlights required?', back: '30 min after sunset to 30 min before sunrise, and when visibility < 1000 ft.' },
  { id: 'pf27', category: 'Traffic Laws', front: 'What does a yellow curb mean?', back: 'Loading/unloading only - no parking.' },
  { id: 'pf28', category: 'Traffic Laws', front: 'What does a white curb mean?', back: 'Stop only to pick up/drop off passengers.' },
  { id: 'pf29', category: 'Traffic Laws', front: 'What does a red curb mean?', back: 'No stopping, standing, or parking at any time.' },
  { id: 'pf30', category: 'Traffic Laws', front: 'What does a blue curb mean?', back: 'Disabled parking only - valid permit required.' },
  { id: 'pf31', category: 'Traffic Laws', front: 'What documents must you carry when driving?', back: 'License, registration, and proof of insurance.' },
  { id: 'pf32', category: 'Traffic Laws', front: 'What is the implied consent law?', back: 'By driving, you agree to chemical testing if suspected of DUI.' },
  { id: 'pf33', category: 'Traffic Laws', front: 'What should you do if you miss your highway exit?', back: 'Continue to the next exit - never back up.' },
  { id: 'pf34', category: 'Traffic Laws', front: 'What is the speed limit in a business district?', back: 'Usually 25 mph unless otherwise posted.' },
  { id: 'pf35', category: 'Traffic Laws', front: 'What is the speed limit in an alley?', back: 'Usually 15 mph unless otherwise posted.' },
  { id: 'pf36', category: 'Traffic Laws', front: 'When can you turn right on red?', back: 'After coming to a complete stop and yielding to traffic/pedestrians.' },
  { id: 'pf37', category: 'Traffic Laws', front: 'What is the minimum following distance behind a fire truck?', back: 'At least 500 feet when responding to emergency.' },
  { id: 'pf38', category: 'Traffic Laws', front: 'When is it legal to pass on the right?', back: 'When vehicle ahead is turning left, or on one-way roads.' },
  { id: 'pf39', category: 'Traffic Laws', front: 'What are HOV lanes for?', back: 'Vehicles with minimum occupants (usually 2+ people).' },
  { id: 'pf40', category: 'Traffic Laws', front: 'When should you use high beams?', back: 'On dark roads with no oncoming traffic. Dim within 500 ft.' },
  { id: 'pf41', category: 'Right-of-Way', front: 'At a four-way stop, who goes first?', back: 'First to arrive and stop. If tied, vehicle on the right.' },
  { id: 'pf42', category: 'Right-of-Way', front: 'Who has right-of-way at an uncontrolled intersection?', back: 'Vehicle on the right when arriving simultaneously.' },
  { id: 'pf43', category: 'Right-of-Way', front: 'When must you yield to pedestrians?', back: 'Always, especially in crosswalks and school zones.' },
  { id: 'pf44', category: 'Right-of-Way', front: 'When entering a roundabout, who yields?', back: 'Entering traffic yields to circulating traffic.' },
  { id: 'pf45', category: 'Right-of-Way', front: 'When making a left turn, to whom must you yield?', back: 'Oncoming traffic and pedestrians.' },
  { id: 'pf46', category: 'Right-of-Way', front: 'Who has right-of-way when merging onto a highway?', back: 'Vehicles already on the highway.' },
  { id: 'pf47', category: 'Right-of-Way', front: 'At a T-intersection, who has right-of-way?', back: 'Traffic on the through road (top of T).' },
  { id: 'pf48', category: 'Right-of-Way', front: 'When should you yield to funeral processions?', back: 'Always - it\'s illegal to interrupt them.' },
  { id: 'pf49', category: 'Right-of-Way', front: 'At a malfunctioning traffic signal, what do you do?', back: 'Treat as a four-way stop.' },
  { id: 'pf50', category: 'Right-of-Way', front: 'When backing out of a driveway, who yields?', back: 'The driver backing out yields to all traffic.' },
  { id: 'pf51', category: 'Right-of-Way', front: 'Who has right-of-way on a narrow mountain road?', back: 'Vehicle going downhill must yield by backing up.' },
  { id: 'pf52', category: 'Right-of-Way', front: 'When must you yield to blind pedestrians?', back: 'Always - those with white cane or guide dog.' },
  { id: 'pf53', category: 'Right-of-Way', front: 'At an intersection with yield sign, what do you do?', back: 'Slow down and yield to through traffic.' },
  { id: 'pf54', category: 'Right-of-Way', front: 'When two cars arrive at opposite sides of a four-way stop?', back: 'If both going straight, proceed simultaneously.' },
  { id: 'pf55', category: 'Right-of-Way', front: 'Who has right-of-way on a one-lane bridge?', back: 'Vehicle that reaches first, or going uphill.' },
  { id: 'pf56', category: 'Safe Driving', front: 'What is the 3-second rule?', back: 'Stay 3 seconds behind vehicle ahead for safe stopping distance.' },
  { id: 'pf57', category: 'Safe Driving', front: 'What should you do if you start to skid?', back: 'Take foot off gas, steer in direction you want to go.' },
  { id: 'pf58', category: 'Safe Driving', front: 'What is defensive driving?', back: 'Anticipating hazards and being prepared for others\' mistakes.' },
  { id: 'pf59', category: 'Safe Driving', front: 'How do you avoid hydroplaning?', back: 'Slow down on wet roads, avoid standing water, good tire tread.' },
  { id: 'pf60', category: 'Safe Driving', front: 'What is the proper hand position on steering wheel?', back: '9 and 3 o\'clock (or 8 and 4) for airbag safety.' },
  { id: 'pf61', category: 'Safe Driving', front: 'When should you use hazard lights?', back: 'When stopped on roadside, driving slowly, or in hazards.' },
  { id: 'pf62', category: 'Safe Driving', front: 'What should you do in dense fog?', back: 'Use low beams, slow down, use road edge as guide.' },
  { id: 'pf63', category: 'Safe Driving', front: 'How do you drive safely in rain?', back: 'Reduce speed, increase following distance, use headlights.' },
  { id: 'pf64', category: 'Safe Driving', front: 'What is target fixation?', back: 'Looking at obstacle causes you to steer toward it - look where you want to go.' },
  { id: 'pf65', category: 'Safe Driving', front: 'How do you recover from going off the road?', back: 'Slow down gradually, steer straight, ease back when safe.' },
  { id: 'pf66', category: 'Safe Driving', front: 'How do you share the road with motorcycles?', back: 'Check blind spots, give full lane width, be aware.' },
  { id: 'pf67', category: 'Safe Driving', front: 'What is the danger of drowsy driving?', back: 'Impairs reaction and judgment similar to alcohol - pull over if tired.' },
  { id: 'pf68', category: 'Safe Driving', front: 'How do you handle a tire blowout?', back: 'Grip wheel, ease off gas, don\'t brake hard, steer to shoulder.' },
  { id: 'pf69', category: 'Safe Driving', front: 'How do you handle an aggressive driver?', back: 'Stay calm, don\'t engage, let them pass, avoid eye contact.' },
  { id: 'pf70', category: 'Safe Driving', front: 'What is proper following distance in bad weather?', back: 'Increase to 4-6 seconds or more.' },
  { id: 'pf71', category: 'Safe Driving', front: 'How do you navigate a roundabout?', back: 'Yield to circulating traffic, go counterclockwise, signal when exiting.' },
  { id: 'pf72', category: 'Safe Driving', front: 'What should you do if your car overheats?', back: 'Turn off AC, turn on heat, pull over, don\'t open radiator when hot.' },
  { id: 'pf73', category: 'Safe Driving', front: 'What should you check before driving?', back: 'Tires, lights, mirrors, fuel, adjust seat and mirrors.' },
  { id: 'pf74', category: 'Safe Driving', front: 'How do you share the road with large trucks?', back: 'Avoid blind spots, don\'t cut them off, give extra space for turns.' },
  { id: 'pf75', category: 'Safe Driving', front: 'What is the proper way to parallel park?', back: 'Align with front car, reverse while turning, straighten, adjust.' },
  { id: 'pf76', category: 'Safe Driving', front: 'What should you do if your brakes fail?', back: 'Pump brakes, use parking brake slowly, shift to lower gear.' },
  { id: 'pf77', category: 'Safe Driving', front: 'How do you drive in snow or ice?', back: 'Reduce speed significantly, increase distance, brake gently.' },
  { id: 'pf78', category: 'Safe Driving', front: 'What is the most important rule of driving?', back: 'Safety first - be alert, follow laws, never drive impaired.' },
  { id: 'pf79', category: 'Traffic Laws', front: 'When making a right turn on red, what must you do first?', back: 'Come to a complete stop, then yield to all traffic and pedestrians.' },
  { id: 'pf80', category: 'Traffic Laws', front: 'What is the fine for not stopping for a school bus?', back: '$250-$500+ and possible license suspension.' },
  { id: 'pf81', category: 'Traffic Laws', front: 'When can you drive in a bike lane?', back: 'Only when turning, entering roadway, or parking where permitted.' },
  { id: 'pf82', category: 'Traffic Laws', front: 'What is the speed limit on most rural interstates?', back: 'Usually 70-75 mph, varies by state.' },
  { id: 'pf83', category: 'Traffic Laws', front: 'When are U-turns generally legal?', back: 'Where posted, or with 500 ft visibility and no prohibitions.' },
  { id: 'pf84', category: 'Traffic Laws', front: 'What does a green curb mean?', back: 'Parking permitted for limited time - check signs.' },
  { id: 'pf85', category: 'Traffic Laws', front: 'What is the minimum age for a learner\'s permit?', back: 'Usually 15-16 years old, varies by state.' },
  { id: 'pf86', category: 'Traffic Laws', front: 'What is the minimum liability insurance required?', back: 'Varies by state - covers bodily injury and property damage.' },
  { id: 'pf87', category: 'Road Signs', front: 'What does a sign showing two arrows in opposite directions mean?', back: 'Two-way traffic ahead - road changes from one-way to two-way.' },
  { id: 'pf88', category: 'Road Signs', front: 'What does a sign with a truck going downhill mean?', back: 'Steep grade ahead - trucks use lower gear.' },
  { id: 'pf89', category: 'Road Signs', front: 'What does a sign with a person digging mean?', back: 'Construction/work zone ahead.' },
  { id: 'pf90', category: 'Road Signs', front: 'What does a yellow X above a lane mean?', back: 'Lane closing ahead - merge safely.' },
  { id: 'pf91', category: 'Road Signs', front: 'What does a flashing yellow arrow mean?', back: 'Yield to oncoming traffic before turning.' },
  { id: 'pf92', category: 'Road Signs', front: 'What does a "No Passing Zone" pennant look like?', back: 'Yellow triangle pointing right on left side of road.' },
  { id: 'pf93', category: 'Safe Driving', front: 'What should you do at a flashing yellow light?', back: 'Slow down and proceed with caution - no stop required.' },
  { id: 'pf94', category: 'Safe Driving', front: 'When should you use high beams?', back: 'On dark roads with no oncoming traffic - dim within 500 ft.' },
  { id: 'pf95', category: 'Safe Driving', front: 'How do you recover from hydroplaning?', back: 'Ease off gas, don\'t brake, steer straight until traction returns.' },
  { id: 'pf96', category: 'Safe Driving', front: 'What should you do if your car starts to skid on ice?', back: 'Take foot off gas, don\'t brake, steer gently in desired direction.' },
  { id: 'pf97', category: 'Right-of-Way', front: 'When should you yield to transit buses?', back: 'When they\'re re-entering traffic from a bus stop (some states).' },
  { id: 'pf98', category: 'Right-of-Way', front: 'When must you stop for a stopped school bus?', back: 'On undivided roads, both directions stop.' },
  { id: 'pf99', category: 'Right-of-Way', front: 'What does a steady red X mean?', back: 'Lane is closed - exit immediately and safely.' },
  { id: 'pf100', category: 'Safe Driving', front: 'What should you do when driving near cyclists?', back: 'Give at least 3 feet of space when passing, check mirrors.' }
];

// ==================== PERMIT TEST DATA ====================
const permitTestQuestions = [
  { id: 'pt1', category: 'Traffic Laws', question: 'What is the legal blood alcohol concentration (BAC) limit for drivers 21 and over?', options: ['0.04%', '0.08%', '0.10%', '0.12%'], correctIndex: 1, explanation: 'The legal BAC limit is 0.08% for drivers 21 and over in most states.' },
  { id: 'pt2', category: 'Traffic Laws', question: 'When must you stop for a school bus with flashing red lights?', options: ['Only if children are visible', 'Only in your direction', 'On both sides of undivided roads', 'Never on weekends'], correctIndex: 2, explanation: 'On undivided roads, you must stop in both directions when a school bus has flashing red lights.' },
  { id: 'pt3', category: 'Road Signs', question: 'What does a red octagonal sign mean?', options: ['Yield', 'Stop', 'Speed limit', 'No entry'], correctIndex: 1, explanation: 'A red octagon is always a STOP sign.' },
  { id: 'pt4', category: 'Right-of-Way', question: 'At a four-way stop, who has the right-of-way?', options: ['The largest vehicle', 'The vehicle on the left', 'The first vehicle to arrive and stop', 'The vehicle with most passengers'], correctIndex: 2, explanation: 'At a four-way stop, the first vehicle to arrive and stop has the right-of-way.' },
  { id: 'pt5', category: 'Traffic Laws', question: 'What is the speed limit in a school zone when children are present?', options: ['10 mph', '15-25 mph (posted)', '35 mph', '45 mph'], correctIndex: 1, explanation: 'School zone speed limits are typically 15-25 mph when children are present.' },
  { id: 'pt6', category: 'Safe Driving', question: 'What is the minimum following distance you should maintain?', options: ['1 second', '2 seconds', '3 seconds', '5 seconds'], correctIndex: 2, explanation: 'The 3-second rule provides adequate stopping distance in normal conditions.' },
  { id: 'pt7', category: 'Road Signs', question: 'What does a yellow diamond-shaped sign indicate?', options: ['Regulatory', 'Warning of hazards', 'Guide information', 'Construction only'], correctIndex: 1, explanation: 'Yellow diamond-shaped signs warn of potential hazards ahead.' },
  { id: 'pt8', category: 'Traffic Laws', question: 'When are headlights required?', options: ['Only at night', '30 min after sunset to 30 min before sunrise and when visibility is poor', 'Only in rain', 'Only on highways'], correctIndex: 1, explanation: 'Headlights are required from 30 min after sunset until 30 min before sunrise, and when visibility < 1000 ft.' },
  { id: 'pt9', category: 'Right-of-Way', question: 'When making a left turn, you must yield to:', options: ['Only pedestrians', 'Only oncoming traffic', 'Oncoming traffic and pedestrians', 'No one if you have green'], correctIndex: 2, explanation: 'When turning left, yield to oncoming traffic and pedestrians.' },
  { id: 'pt10', category: 'Traffic Laws', question: 'What does a flashing red light mean?', options: ['Proceed with caution', 'Stop, then proceed when safe', 'Slow down', 'Road closed'], correctIndex: 1, explanation: 'A flashing red light is treated like a stop sign.' },
  { id: 'pt11', category: 'Safe Driving', question: 'What should you do if your vehicle starts to hydroplane?', options: ['Brake hard', 'Accelerate', 'Ease off gas and steer straight', 'Turn wheel sharply'], correctIndex: 2, explanation: 'Ease off the gas, don\'t brake, and steer straight until you regain traction.' },
  { id: 'pt12', category: 'Road Signs', question: 'What does a pentagon-shaped sign indicate?', options: ['Construction zone', 'School zone or crossing', 'No passing zone', 'Railroad crossing'], correctIndex: 1, explanation: 'Pentagon-shaped signs indicate school zones or crossings.' },
  { id: 'pt13', category: 'Traffic Laws', question: 'What documents must you carry when driving?', options: ['Just your license', 'License and registration', 'License, registration, and insurance', 'No documents needed'], correctIndex: 2, explanation: 'You must carry license, registration, and proof of insurance.' },
  { id: 'pt14', category: 'Right-of-Way', question: 'Who has right-of-way when entering a roundabout?', options: ['Entering traffic', 'Traffic already circulating', 'Larger vehicles', 'Emergency vehicles only'], correctIndex: 1, explanation: 'Traffic already circulating has the right-of-way.' },
  { id: 'pt15', category: 'Safe Driving', question: 'What should you do if you miss your exit on a highway?', options: ['Back up to exit', 'Make U-turn on shoulder', 'Continue to next exit', 'Stop and wait'], correctIndex: 2, explanation: 'Never back up or make U-turns on highways. Continue to the next exit.' },
  { id: 'pt16', category: 'Traffic Laws', question: 'What is the implied consent law?', options: ['Agree to follow traffic laws', 'Agree to chemical testing if suspected of DUI', 'Consent to vehicle searches', 'Agree to pay fines'], correctIndex: 1, explanation: 'By driving, you agree to chemical testing if suspected of DUI.' },
  { id: 'pt17', category: 'Road Signs', question: 'What does a red circle with white horizontal bar mean?', options: ['Speed limit', 'Do not enter', 'No parking', 'Yield ahead'], correctIndex: 1, explanation: 'A red circle with white horizontal bar means DO NOT ENTER.' },
  { id: 'pt18', category: 'Safe Driving', question: 'When driving in fog, you should use:', options: ['High beams', 'Low beams', 'Parking lights', 'No lights'], correctIndex: 1, explanation: 'Use low beams - high beams reflect off fog and reduce visibility.' },
  { id: 'pt19', category: 'Right-of-Way', question: 'At an uncontrolled intersection, who has right-of-way?', options: ['Vehicle on left', 'Vehicle on right', 'Faster vehicle', 'Larger vehicle'], correctIndex: 1, explanation: 'At an uncontrolled intersection, the vehicle on the right has right-of-way.' },
  { id: 'pt20', category: 'Traffic Laws', question: 'When making a right turn on red, you must:', options: ['Just slow down', 'Stop first, then yield before turning', 'Wait for green', 'Honk before turning'], correctIndex: 1, explanation: 'Stop completely, then yield to all traffic and pedestrians before turning.' },
  { id: 'pt21', category: 'Road Signs', question: 'What does an orange diamond-shaped sign indicate?', options: ['School zone', 'Construction zone', 'No passing', 'Speed change'], correctIndex: 1, explanation: 'Orange diamond-shaped signs indicate construction zones.' },
  { id: 'pt22', category: 'Safe Driving', question: 'What is the proper hand position on the steering wheel?', options: ['10 and 2 o\'clock', '9 and 3 o\'clock', 'One hand at 12', 'Both at 6 o\'clock'], correctIndex: 1, explanation: '9 and 3 o\'clock is recommended for airbag safety and control.' },
  { id: 'pt23', category: 'Traffic Laws', question: 'How far must you stop from a railroad crossing?', options: ['5-10 feet', '15-50 feet', '100 feet', '200 feet'], correctIndex: 1, explanation: 'Stop at least 15 feet but no more than 50 feet from the nearest rail.' },
  { id: 'pt24', category: 'Right-of-Way', question: 'When must you yield to emergency vehicles?', options: ['Only when they honk', 'Only at intersections', 'Always when they have sirens/flashing lights', 'Only on highways'], correctIndex: 2, explanation: 'Always yield to emergency vehicles with active sirens/flashing lights.' },
  { id: 'pt25', category: 'Road Signs', question: 'What does a green arrow traffic signal mean?', options: ['Yield to pedestrians', 'Protected turn - proceed in direction shown', 'Slow down', 'Prepare to stop'], correctIndex: 1, explanation: 'A green arrow means protected turn - proceed in direction shown.' },
  { id: 'pt26', category: 'Safe Driving', question: 'What is target fixation?', options: ['Focusing on destination', 'Looking at obstacle causes you to steer toward it', 'Checking mirrors', 'Watching for police'], correctIndex: 1, explanation: 'Target fixation is when looking at an obstacle causes you to steer toward it.' },
  { id: 'pt27', category: 'Traffic Laws', question: 'What does a yellow curb mean?', options: ['No parking', 'Loading/unloading only', 'Disabled parking', 'Short-term parking'], correctIndex: 1, explanation: 'A yellow curb means loading/unloading only.' },
  { id: 'pt28', category: 'Right-of-Way', question: 'When two vehicles arrive at opposite sides of a four-way stop simultaneously:', options: ['Larger vehicle goes first', 'Both can proceed if going straight', 'Left-turning vehicle goes first', 'Vehicle on left goes first'], correctIndex: 1, explanation: 'If both going straight, they can proceed simultaneously.' },
  { id: 'pt29', category: 'Road Signs', question: 'What does a flashing yellow light mean?', options: ['Stop completely', 'Proceed with caution', 'Yield to all', 'Road closed'], correctIndex: 1, explanation: 'Flashing yellow means slow down and proceed with caution.' },
  { id: 'pt30', category: 'Safe Driving', question: 'How should you share the road with large trucks?', options: ['Pass quickly on right', 'Stay in blind spots', 'Avoid blind spots and give extra space', 'Follow closely'], correctIndex: 2, explanation: 'Avoid trucks\' blind spots, don\'t cut them off, give extra space.' },
  { id: 'pt31', category: 'Traffic Laws', question: 'When must you use your turn signal?', options: ['Only on highways', 'Only when others present', 'At least 100 feet before turning', 'Only at night'], correctIndex: 2, explanation: 'Signal at least 100 feet before turning or changing lanes.' },
  { id: 'pt32', category: 'Right-of-Way', question: 'When entering a highway from an on-ramp:', options: ['Stop at end of ramp', 'Accelerate to match speed and merge', 'Expect traffic to yield', 'Drive on shoulder'], correctIndex: 1, explanation: 'Use acceleration lane to reach highway speed, then merge safely.' },
  { id: 'pt33', category: 'Road Signs', question: 'What does a brown sign indicate?', options: ['Construction', 'Recreational/cultural areas', 'Speed limit', 'Hospital'], correctIndex: 1, explanation: 'Brown signs point to parks, historical sites, attractions.' },
  { id: 'pt34', category: 'Safe Driving', question: 'What should you do if your brakes fail?', options: ['Turn off engine', 'Pump brakes, use parking brake, shift to lower gear', 'Jump out', 'Steer into traffic'], correctIndex: 1, explanation: 'Pump brakes, use parking brake slowly, shift to lower gear.' },
  { id: 'pt35', category: 'Traffic Laws', question: 'What is the "Move Over" law?', options: ['Move for faster traffic', 'Move over or slow down for emergency vehicles', 'Move for pedestrians', 'Move in construction only'], correctIndex: 1, explanation: 'Move over one lane or slow down for emergency vehicles with flashing lights.' },
  { id: 'pt36', category: 'Right-of-Way', question: 'At a T-intersection with no signs, who has right-of-way?', options: ['The turning vehicle', 'Traffic on through road', 'First to arrive', 'Vehicle on left'], correctIndex: 1, explanation: 'Traffic on the through road has right-of-way.' },
  { id: 'pt37', category: 'Road Signs', question: 'What does a circular sign indicate?', options: ['Speed limit', 'Railroad crossing', 'School zone', 'Construction'], correctIndex: 1, explanation: 'Circular signs indicate railroad crossings.' },
  { id: 'pt38', category: 'Safe Driving', question: 'What should you do if you start to skid?', options: ['Brake hard', 'Accelerate', 'Take foot off gas, steer in desired direction', 'Turn opposite direction'], correctIndex: 2, explanation: 'Take foot off gas, don\'t brake, steer where you want to go.' },
  { id: 'pt39', category: 'Traffic Laws', question: 'What is the minimum age for a learner\'s permit in most states?', options: ['14 years', '15-16 years', '17 years', '18 years'], correctIndex: 1, explanation: 'Most states allow learner\'s permit at 15 or 16.' },
  { id: 'pt40', category: 'Right-of-Way', question: 'At a malfunctioning traffic signal:', options: ['Proceed without stopping', 'Treat as four-way stop', 'Assume you have right-of-way', 'Wait for police'], correctIndex: 1, explanation: 'Treat malfunctioning signal as four-way stop.' }
];

// ==================== SCENARIO DATA ====================
const scenarioQuestions = [
  { id: 'sq1', topic: 'Parallel Parking', scenario: 'You need to parallel park between two cars. There\'s about 1.5 car lengths of space.', question: 'What is your first step after stopping beside the front car?', options: ['Turn wheel sharply right and reverse', 'Align rear bumpers, then reverse slowly', 'Signal and find bigger space', 'Wait for traffic to clear'], correctIndex: 1, explanation: 'Align your rear bumper with the front car\'s rear bumper before beginning to reverse.', difficulty: 'medium' },
  { id: 'sq2', topic: 'Parallel Parking', scenario: 'During parallel parking, you\'ve backed in but are 24 inches from the curb - too far.', question: 'What should you do?', options: ['Start over', 'Pull forward while turning right, then reverse turning left', 'Open door to check', 'Accept as is'], correctIndex: 1, explanation: 'Adjust by pulling forward while turning toward curb, then reversing while turning away.', difficulty: 'medium' },
  { id: 'sq3', topic: 'Parallel Parking', scenario: 'There\'s a car waiting behind you while you try to parallel park.', question: 'What should you do?', options: ['Rush to finish', 'Take your time and park correctly', 'Give up and drive away', 'Wave them around'], correctIndex: 1, explanation: 'Don\'t let pressure rush you. Take time to park correctly. Use hazard lights if needed.', difficulty: 'easy' },
  { id: 'sq4', topic: 'Parallel Parking', scenario: 'You hit the curb while parallel parking. Your tire is touching the curb.', question: 'Is this an automatic fail on a driving test?', options: ['Yes, any curb contact fails', 'No, but you should correct it', 'Only if you hit hard', 'Depends on examiner'], correctIndex: 1, explanation: 'Light curb contact isn\'t always an automatic fail, but you should correct it.', difficulty: 'medium' },
  { id: 'sq5', topic: 'Highway Driving', scenario: 'You\'re merging onto a highway. The acceleration lane is ending. Traffic is at 65 mph.', question: 'What should you do?', options: ['Stop at end of ramp', 'Accelerate to match speed and merge', 'Drive on shoulder', 'Slow down and let traffic pass'], correctIndex: 1, explanation: 'Use the acceleration lane to reach highway speed, then merge safely.', difficulty: 'easy' },
  { id: 'sq6', topic: 'Highway Driving', scenario: 'You\'re in the right lane and see a car merging ahead from an on-ramp.', question: 'What should you do?', options: ['Maintain speed', 'Change lanes or adjust speed to create gap', 'Speed up to pass', 'Slow down significantly'], correctIndex: 1, explanation: 'Change lanes if possible, or adjust speed to create space.', difficulty: 'easy' },
  { id: 'sq7', topic: 'Highway Driving', scenario: 'You miss your exit on the highway. There\'s an emergency turnaround nearby.', question: 'What should you do?', options: ['Use the turnaround', 'Back up on shoulder', 'Continue to next exit', 'Make U-turn at crossover'], correctIndex: 2, explanation: 'Never use emergency turnarounds. Continue to the next exit.', difficulty: 'easy' },
  { id: 'sq8', topic: 'Highway Driving', scenario: 'You need to exit in 2 miles. You\'re in the left lane in heavy traffic.', question: 'When should you move right?', options: ['Stay left until last moment', 'Move right as soon as safe', 'Only when you see exit', 'Doesn\'t matter'], correctIndex: 1, explanation: 'Move right well before your exit for safety.', difficulty: 'easy' },
  { id: 'sq9', topic: 'Adverse Conditions', scenario: 'It\'s raining heavily. Your car starts to hydroplane.', question: 'What should you do?', options: ['Brake hard', 'Steer sharply to shoulder', 'Ease off gas and steer straight', 'Accelerate through water'], correctIndex: 2, explanation: 'Ease off gas, don\'t brake, steer straight until you regain traction.', difficulty: 'hard' },
  { id: 'sq10', topic: 'Adverse Conditions', scenario: 'You\'re driving in dense fog with visibility less than 200 feet.', question: 'What should you do?', options: ['Use high beams', 'Use low beams and reduce speed', 'Follow taillights closely', 'Pull over immediately'], correctIndex: 1, explanation: 'Use low beams, slow down, use road lines as guides.', difficulty: 'medium' },
  { id: 'sq11', topic: 'Adverse Conditions', scenario: 'You encounter black ice on a curve and start to skid.', question: 'What should you do?', options: ['Brake firmly', 'Steer opposite of skid', 'Take foot off gas, steer in desired direction', 'Accelerate for traction'], correctIndex: 2, explanation: 'Take foot off gas, don\'t brake, steer gently where you want to go.', difficulty: 'hard' },
  { id: 'sq12', topic: 'Adverse Conditions', scenario: 'Night driving in rain. An oncoming vehicle has high beams on, blinding you.', question: 'What should you do?', options: ['Flash your high beams', 'Look toward right edge of road', 'Close your eyes', 'Speed up to pass'], correctIndex: 1, explanation: 'Look toward the right edge of your lane to avoid glare.', difficulty: 'medium' },
  { id: 'sq13', topic: 'Intersections', scenario: 'You arrive at a four-way stop at the same time as cars on your right and across from you.', question: 'Who goes first?', options: ['You go first', 'Car on your right', 'Car across from you', 'Everyone at once'], correctIndex: 1, explanation: 'At a four-way stop, the car on the right has right-of-way.', difficulty: 'medium' },
  { id: 'sq14', topic: 'Intersections', scenario: 'You\'re waiting to turn left at a green light. It turns yellow, then red. Cars are still in intersection.', question: 'What should you do?', options: ['Turn quickly', 'Wait until clear, then turn', 'Back up to stop line', 'Wait for next green'], correctIndex: 1, explanation: 'Complete turn only when intersection is clear. You legally entered on green.', difficulty: 'medium' },
  { id: 'sq15', topic: 'Intersections', scenario: 'The traffic light is not working. No police are directing traffic.', question: 'How should you proceed?', options: ['Drive through', 'Treat as four-way stop', 'Yield only to left', 'Wait for direction'], correctIndex: 1, explanation: 'Treat malfunctioning signal as a four-way stop.', difficulty: 'easy' },
  { id: 'sq16', topic: 'Intersections', scenario: 'You\'re turning right on red. A pedestrian is waiting to cross your path.', question: 'What should you do?', options: ['Turn before they enter crosswalk', 'Wait for pedestrian to cross', 'Honk to alert them', 'Edge forward'], correctIndex: 1, explanation: 'Always yield to pedestrians. Wait until they cross safely.', difficulty: 'easy' },
  { id: 'sq17', topic: 'Emergency Vehicles', scenario: 'You hear a siren approaching from behind but can\'t see the vehicle.', question: 'What should you do?', options: ['Continue at current speed', 'Pull over to right and stop', 'Speed up', 'Stop in current lane'], correctIndex: 1, explanation: 'Pull over to the right and stop until you know where it\'s coming from.', difficulty: 'easy' },
  { id: 'sq18', topic: 'Emergency Vehicles', scenario: 'An ambulance is stopped with lights flashing in the lane next to you.', question: 'What should you do?', options: ['Continue at normal speed', 'Slow down and pass', 'Move over or slow down significantly', 'Stop and wait'], correctIndex: 2, explanation: 'Move over law: change lanes if possible, or slow down significantly.', difficulty: 'easy' },
  { id: 'sq19', topic: 'School Zones', scenario: 'You approach a school zone with flashing yellow lights and children present.', question: 'What should you do?', options: ['Continue normal speed', 'Reduce to posted school zone limit', 'Only slow if children in road', 'Speed up to pass through'], correctIndex: 1, explanation: 'Always reduce to posted limit when lights are flashing and children present.', difficulty: 'easy' },
  { id: 'sq20', topic: 'School Zones', scenario: 'A school bus has stopped with red lights flashing on the opposite side of a divided highway with median.', question: 'Do you need to stop?', options: ['Yes, always', 'No, proceed with caution', 'Only if children crossing', 'Only if bus signals'], correctIndex: 1, explanation: 'On divided highway with median, you don\'t need to stop but proceed cautiously.', difficulty: 'medium' }
];

// ==================== STATE ====================
let progress = {
  permitFlashcards: { seen: [], known: [], needsPractice: [] },
  permitTest: { testsTaken: 0, passedTests: 0, averageScore: 0, highScore: 0 },
  scenarioTest: { testsTaken: 0, passedTests: 0, averageScore: 0, highScore: 0 },
  streak: { count: 0, lastDate: null },
  lastSession: new Date().toISOString()
};

let session = { permitTest: null, scenarioTest: null, permitFlashcards: null };
let currentDeck = [...permitFlashcards];
let currentCardIndex = 0;
let isFlipped = false;
let currentCategory = 'all';
let testQuestions = [];
let testIndex = 0;
let testAnswers = [];
let testTime = 45 * 60;
let testTimer = null;
let selectedTestAnswer = null;
let testFinished = false;
let scenarioIndex = 0;
let scenarioAnswers = [];
let selectedScenarioAnswer = null;
let scenarioFinished = false;

// ==================== THEME ====================
function initTheme() {
  const saved = localStorage.getItem('driveyourtest_theme');
  if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
  }
}

function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('theme-icon').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
  localStorage.setItem('driveyourtest_theme', isDark ? 'light' : 'dark');
  showToast(isDark ? '‚òÄÔ∏è Light mode enabled' : 'üåô Dark mode enabled');
}

// ==================== TOAST ====================
function showToast(message, icon = '‚ú®') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-message">${message}</span>`;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ==================== CONFETTI ====================
function launchConfetti() {
  const container = document.getElementById('confetti-container');
  const colors = ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444'];
  
  for (let i = 0; i < 100; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 2 + 's';
    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
    container.appendChild(confetti);
    setTimeout(() => confetti.remove(), 3000);
  }
}

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', () => {
  initTheme();
  loadProgress();
  loadSession();
  updateHomeProgress();
  checkResumeBanner();
  checkStreak();
});

function loadProgress() {
  const saved = localStorage.getItem('driveyourtest_progress');
  if (saved) progress = { ...progress, ...JSON.parse(saved) };
}

function saveProgress() {
  progress.lastSession = new Date().toISOString();
  localStorage.setItem('driveyourtest_progress', JSON.stringify(progress));
}

function loadSession() {
  const saved = localStorage.getItem('driveyourtest_session');
  if (saved) session = { ...session, ...JSON.parse(saved) };
}

function saveSession() {
  localStorage.setItem('driveyourtest_session', JSON.stringify(session));
}

function clearSession() {
  session = { permitTest: null, scenarioTest: null, permitFlashcards: null };
  localStorage.removeItem('driveyourtest_session');
}

function clearSessionAndRefresh() {
  clearSession();
  location.reload();
}

function checkResumeBanner() {
  const banner = document.getElementById('resume-banner');
  if (session.permitTest?.active || session.scenarioTest?.active) {
    banner.classList.remove('hidden');
  }
}

function checkStreak() {
  const today = new Date().toDateString();
  const lastDate = progress.streak.lastDate ? new Date(progress.streak.lastDate).toDateString() : null;
  
  if (lastDate !== today) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    if (lastDate === yesterday.toDateString()) {
      progress.streak.count++;
      showToast(`${progress.streak.count} day streak! Keep it up! üî•`, 'üî•');
    } else if (lastDate !== today) {
      progress.streak.count = 1;
    }
    progress.streak.lastDate = today;
    saveProgress();
  }
}

// ==================== NAVIGATION ====================
function showView(viewId) {
  document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
  document.getElementById(viewId + '-view').classList.add('active');
}

function goHome() {
  if (testTimer) clearInterval(testTimer);
  showView('home');
  updateHomeProgress();
}

function confirmExit() {
  if (confirm('Exit? Progress will be saved.')) goHome();
}

function updateHomeProgress() {
  const seenCount = progress.permitFlashcards.seen.length;
  const knownCount = progress.permitFlashcards.known.length;
  const flashcardPct = Math.round((knownCount / 100) * 100);
  
  document.getElementById('flashcard-progress').textContent = flashcardPct + '%';
  document.getElementById('flashcard-bar').style.width = flashcardPct + '%';
  document.getElementById('permit-tests').textContent = progress.permitTest.testsTaken;
  document.getElementById('best-score').textContent = progress.permitTest.highScore > 0 ? progress.permitTest.highScore + '%' : '-';
  document.getElementById('streak-count').textContent = progress.streak.count;
}

// ==================== FLASHCARDS ====================
function startFlashcards() {
  if (session.permitFlashcards) {
    currentCategory = session.permitFlashcards.category || 'all';
    currentCardIndex = session.permitFlashcards.index || 0;
  } else {
    currentCategory = 'all';
    currentCardIndex = 0;
  }
  selectCategory(currentCategory);
  showView('flashcards');
}

function selectCategory(category) {
  currentCategory = category;
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.category === category);
  });
  
  currentDeck = category === 'all' ? [...permitFlashcards] : permitFlashcards.filter(c => c.category === category);
  if (currentCardIndex >= currentDeck.length) currentCardIndex = 0;
  
  document.getElementById('card-total').textContent = currentDeck.length;
  isFlipped = false;
  updateFlashcard();
  saveFlashcardSession();
}

function updateFlashcard() {
  const card = currentDeck[currentCardIndex];
  document.getElementById('flashcard').classList.remove('flipped');
  isFlipped = false;
  
  document.getElementById('card-category').textContent = card.category;
  document.getElementById('card-front').textContent = card.front;
  document.getElementById('card-back').textContent = card.back;
  document.getElementById('card-index').textContent = currentCardIndex + 1;
  
  document.getElementById('prev-btn').disabled = currentCardIndex === 0;
  document.getElementById('next-btn').disabled = currentCardIndex === currentDeck.length - 1;
}

function flipCard() {
  isFlipped = !isFlipped;
  document.getElementById('flashcard').classList.toggle('flipped', isFlipped);
}

function prevCard() {
  if (currentCardIndex > 0) {
    currentCardIndex--;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function nextCard() {
  if (currentCardIndex < currentDeck.length - 1) {
    currentCardIndex++;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function rateCard(rating) {
  const card = currentDeck[currentCardIndex];
  
  if (!progress.permitFlashcards.seen.includes(card.id)) {
    progress.permitFlashcards.seen.push(card.id);
  }
  
  if (rating === 'known') {
    if (!progress.permitFlashcards.known.includes(card.id)) {
      progress.permitFlashcards.known.push(card.id);
      showToast('Great job! Card mastered! ‚úì', 'üéâ');
    }
    progress.permitFlashcards.needsPractice = progress.permitFlashcards.needsPractice.filter(id => id !== card.id);
  } else {
    if (!progress.permitFlashcards.needsPractice.includes(card.id)) {
      progress.permitFlashcards.needsPractice.push(card.id);
    }
    progress.permitFlashcards.known = progress.permitFlashcards.known.filter(id => id !== card.id);
  }
  
  saveProgress();
  
  if (currentCardIndex < currentDeck.length - 1) {
    currentCardIndex++;
    isFlipped = false;
    updateFlashcard();
    saveFlashcardSession();
  }
}

function saveFlashcardSession() {
  session.permitFlashcards = { category: currentCategory, index: currentCardIndex };
  saveSession();
}

// ==================== PERMIT TEST ====================
function startPermitTest() {
  if (session.permitTest?.active) {
    testQuestions = session.permitTest.questions;
    testIndex = session.permitTest.index;
    testAnswers = session.permitTest.answers;
    selectedTestAnswer = session.permitTest.selectedAnswer;
    testTime = session.permitTest.timeLeft;
    testFinished = false;
  } else {
    testQuestions = [...permitTestQuestions].sort(() => Math.random() - 0.5);
    testIndex = 0;
    testAnswers = new Array(testQuestions.length).fill(null);
    testTime = 45 * 60;
    selectedTestAnswer = null;
    testFinished = false;
  }
  
  showView('permit-test');
  document.getElementById('test-results').classList.add('hidden');
  document.getElementById('test-question-card').classList.remove('hidden');
  document.getElementById('test-actions').classList.remove('hidden');
  document.getElementById('test-total').textContent = testQuestions.length;
  
  updateTimerDisplay();
  startTimer();
  displayTestQuestion();
  saveTestSession();
}

function startTimer() {
  if (testTimer) clearInterval(testTimer);
  testTimer = setInterval(() => {
    testTime--;
    updateTimerDisplay();
    if (testTime <= 0) {
      clearInterval(testTimer);
      finishTest();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const mins = Math.floor(testTime / 60);
  const secs = testTime % 60;
  const timerEl = document.getElementById('test-timer');
  timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
  
  timerEl.classList.remove('warning', 'danger');
  if (testTime <= 300) timerEl.classList.add('danger');
  else if (testTime <= 600) timerEl.classList.add('warning');
}

function displayTestQuestion() {
  const q = testQuestions[testIndex];
  document.getElementById('test-category').textContent = q.category;
  document.getElementById('test-question').textContent = q.question;
  document.getElementById('test-index').textContent = testIndex + 1;
  document.getElementById('test-progress-bar').style.width = ((testIndex + 1) / testQuestions.length) * 100 + '%';
  
  const optionsContainer = document.getElementById('test-options');
  optionsContainer.innerHTML = '';
  
  const isAnswered = testAnswers[testIndex] !== null;
  
  q.options.forEach((opt, i) => {
    const item = document.createElement('div');
    item.className = 'option-item';
    if (isAnswered) {
      item.classList.add('disabled');
      if (i === q.correctIndex) item.classList.add('correct');
      else if (i === testAnswers[testIndex]) item.classList.add('incorrect');
    } else if (selectedTestAnswer === i) {
      item.classList.add('selected');
    }
    item.innerHTML = `<div class="option-radio"></div><span class="option-text">${opt}</span>`;
    if (!isAnswered) item.onclick = () => selectTestOption(i);
    optionsContainer.appendChild(item);
  });
  
  if (isAnswered) {
    const explanation = document.createElement('div');
    explanation.className = 'explanation';
    explanation.innerHTML = `<div class="explanation-title">Explanation</div><div class="explanation-text">${q.explanation}</div>`;
    optionsContainer.appendChild(explanation);
  }
  
  document.getElementById('submit-btn').classList.toggle('hidden', isAnswered);
  document.getElementById('submit-btn').disabled = selectedTestAnswer === null && !isAnswered;
  document.getElementById('next-question-btn').classList.toggle('hidden', !isAnswered);
  document.getElementById('next-question-btn').textContent = testIndex === testQuestions.length - 1 && isAnswered ? 'See Results ‚Üí' : 'Next Question ‚Üí';
}

function selectTestOption(index) {
  if (testAnswers[testIndex] !== null) return;
  selectedTestAnswer = index;
  displayTestQuestion();
  saveTestSession();
}

function submitTestAnswer() {
  if (selectedTestAnswer === null) return;
  testAnswers[testIndex] = selectedTestAnswer;
  
  const q = testQuestions[testIndex];
  if (selectedTestAnswer === q.correctIndex) {
    showToast('Correct! Great job! ‚úì', '‚úÖ');
  }
  
  displayTestQuestion();
  saveTestSession();
}

function nextTestQuestion() {
  if (testIndex < testQuestions.length - 1) {
    testIndex++;
    selectedTestAnswer = testAnswers[testIndex];
    displayTestQuestion();
    saveTestSession();
  } else {
    finishTest();
  }
}

function finishTest() {
  if (testTimer) clearInterval(testTimer);
  testFinished = true;
  
  const correct = testAnswers.filter((a, i) => a === testQuestions[i].correctIndex).length;
  const total = testQuestions.length;
  const score = Math.round((correct / total) * 100);
  const passed = score >= 80;
  
  document.getElementById('test-question-card').classList.add('hidden');
  document.getElementById('test-actions').classList.add('hidden');
  document.getElementById('test-results').classList.remove('hidden');
  
  document.getElementById('results-icon').textContent = passed ? 'üéâ' : 'üìö';
  document.getElementById('results-title').textContent = passed ? 'Congratulations!' : 'Keep Practicing!';
  document.getElementById('results-title').style.color = passed ? 'var(--emerald-500)' : 'var(--amber-500)';
  document.getElementById('results-score').textContent = score + '%';
  document.getElementById('results-score').style.color = passed ? 'var(--emerald-500)' : 'var(--amber-500)';
  document.getElementById('correct-count').textContent = correct;
  document.getElementById('incorrect-count').textContent = total - correct;
  
  if (passed) {
    launchConfetti();
    showToast('You passed! Great work! üéâ', 'üèÜ');
  }
  
  progress.permitTest.testsTaken++;
  progress.permitTest.averageScore = Math.round((progress.permitTest.averageScore * (progress.permitTest.testsTaken - 1) + score) / progress.permitTest.testsTaken);
  if (score > progress.permitTest.highScore) progress.permitTest.highScore = score;
  if (passed) progress.permitTest.passedTests++;
  saveProgress();
  
  session.permitTest = null;
  saveSession();
}

function saveTestSession() {
  session.permitTest = {
    active: !testFinished,
    questions: testQuestions,
    index: testIndex,
    answers: testAnswers,
    selectedAnswer: selectedTestAnswer,
    timeLeft: testTime
  };
  saveSession();
}

// ==================== SCENARIOS ====================
function startScenarios() {
  if (session.scenarioTest?.active) {
    scenarioIndex = session.scenarioTest.index;
    scenarioAnswers = session.scenarioTest.answers;
    selectedScenarioAnswer = session.scenarioTest.selectedAnswer;
  } else {
    scenarioIndex = 0;
    scenarioAnswers = new Array(scenarioQuestions.length).fill(null);
    selectedScenarioAnswer = null;
  }
  scenarioFinished = false;
  
  showView('scenarios');
  document.getElementById('scenario-results').classList.add('hidden');
  document.getElementById('scenario-card').classList.remove('hidden');
  document.getElementById('scenario-question-card').classList.remove('hidden');
  document.getElementById('scenario-actions').classList.remove('hidden');
  document.getElementById('scenario-total').textContent = scenarioQuestions.length;
  
  displayScenarioQuestion();
  saveScenarioSession();
}

function displayScenarioQuestion() {
  const s = scenarioQuestions[scenarioIndex];
  document.getElementById('scenario-topic').textContent = s.topic;
  document.getElementById('scenario-difficulty').textContent = s.difficulty;
  document.getElementById('scenario-difficulty').className = 'difficulty-badge difficulty-' + s.difficulty;
  document.getElementById('scenario-text').textContent = s.scenario;
  document.getElementById('scenario-question').textContent = s.question;
  document.getElementById('scenario-index').textContent = scenarioIndex + 1;
  document.getElementById('scenario-progress-bar').style.width = ((scenarioIndex + 1) / scenarioQuestions.length) * 100 + '%';
  
  const optionsContainer = document.getElementById('scenario-options');
  optionsContainer.innerHTML = '';
  
  const isAnswered = scenarioAnswers[scenarioIndex] !== null;
  
  s.options.forEach((opt, i) => {
    const item = document.createElement('div');
    item.className = 'option-item';
    if (isAnswered) {
      item.classList.add('disabled');
      if (i === s.correctIndex) item.classList.add('correct');
      else if (i === scenarioAnswers[scenarioIndex]) item.classList.add('incorrect');
    } else if (selectedScenarioAnswer === i) {
      item.classList.add('selected');
    }
    item.innerHTML = `<div class="option-radio"></div><span class="option-text">${opt}</span>`;
    if (!isAnswered) item.onclick = () => selectScenarioOption(i);
    optionsContainer.appendChild(item);
  });
  
  if (isAnswered) {
    const explanation = document.createElement('div');
    explanation.className = 'explanation';
    explanation.innerHTML = `<div class="explanation-title">Explanation</div><div class="explanation-text">${s.explanation}</div>`;
    optionsContainer.appendChild(explanation);
  }
  
  document.getElementById('scenario-submit-btn').classList.toggle('hidden', isAnswered);
  document.getElementById('scenario-submit-btn').disabled = selectedScenarioAnswer === null && !isAnswered;
  document.getElementById('next-scenario-btn').classList.toggle('hidden', !isAnswered);
  document.getElementById('next-scenario-btn').textContent = scenarioIndex === scenarioQuestions.length - 1 && isAnswered ? 'See Results ‚Üí' : 'Next Scenario ‚Üí';
}

function selectScenarioOption(index) {
  if (scenarioAnswers[scenarioIndex] !== null) return;
  selectedScenarioAnswer = index;
  displayScenarioQuestion();
  saveScenarioSession();
}

function submitScenarioAnswer() {
  if (selectedScenarioAnswer === null) return;
  scenarioAnswers[scenarioIndex] = selectedScenarioAnswer;
  
  const s = scenarioQuestions[scenarioIndex];
  if (selectedScenarioAnswer === s.correctIndex) {
    showToast('Correct! Well done! ‚úì', '‚úÖ');
  }
  
  displayScenarioQuestion();
  saveScenarioSession();
}

function nextScenario() {
  if (scenarioIndex < scenarioQuestions.length - 1) {
    scenarioIndex++;
    selectedScenarioAnswer = scenarioAnswers[scenarioIndex];
    displayScenarioQuestion();
    saveScenarioSession();
  } else {
    finishScenarios();
  }
}

function finishScenarios() {
  scenarioFinished = true;
  
  const correct = scenarioAnswers.filter((a, i) => a === scenarioQuestions[i].correctIndex).length;
  const total = scenarioQuestions.length;
  const score = Math.round((correct / total) * 100);
  const passed = score >= 80;
  
  document.getElementById('scenario-card').classList.add('hidden');
  document.getElementById('scenario-question-card').classList.add('hidden');
  document.getElementById('scenario-actions').classList.add('hidden');
  document.getElementById('scenario-results').classList.remove('hidden');
  
  document.getElementById('scenario-results-icon').textContent = passed ? 'üéâ' : 'üìö';
  document.getElementById('scenario-results-title').textContent = passed ? 'Great Job!' : 'Keep Practicing!';
  document.getElementById('scenario-results-title').style.color = passed ? 'var(--purple-500)' : 'var(--amber-500)';
  document.getElementById('scenario-results-score').textContent = score + '%';
  document.getElementById('scenario-results-score').style.color = passed ? 'var(--purple-500)' : 'var(--amber-500)';
  document.getElementById('scenario-correct-count').textContent = correct;
  document.getElementById('scenario-incorrect-count').textContent = total - correct;
  
  if (passed) {
    launchConfetti();
    showToast('Excellent work! üéâ', 'üèÜ');
  }
  
  progress.scenarioTest.testsTaken++;
  progress.scenarioTest.averageScore = Math.round((progress.scenarioTest.averageScore * (progress.scenarioTest.testsTaken - 1) + score) / progress.scenarioTest.testsTaken);
  if (score > progress.scenarioTest.highScore) progress.scenarioTest.highScore = score;
  if (passed) progress.scenarioTest.passedTests++;
  saveProgress();
  
  session.scenarioTest = null;
  saveSession();
}

function saveScenarioSession() {
  session.scenarioTest = {
    active: !scenarioFinished,
    index: scenarioIndex,
    answers: scenarioAnswers,
    selectedAnswer: selectedScenarioAnswer
  };
  saveSession();
}
</script>
</body>
</html>
